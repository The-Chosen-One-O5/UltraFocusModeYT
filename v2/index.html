<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
    <title>Ultra Focus Mode</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="stylesheet" href="styles.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

    <div class="game-container">

        <nav id="topNavBar">
             <a href="#" id="navLogo" title="Quest for Focus" data-action="show-view" data-view="homePage">
                <img src="logo.png" alt="Quest for Focus Logo">
            </a>
            <div id="navClockContainer"> <span id="navClockTime">00:00:00</span> <span id="navClockPeriod">AM</span> </div>
            <div id="navButtons">
                <span id="navStreakDisplay"><i class="fas fa-fire"></i> 0 days focus</span>
                <span id="navUserArea" style="display:none;align-items:center;gap:8px;">
                    <img id="navUserPhoto" alt="avatar" style="width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid var(--primary);display:none;">
                    <span id="navUserName" style="font-size:14px;color:var(--text-dim);"></span>
                </span>
                <button id="navProfileBtn" title="Profile" data-action="show-view" data-view="profile"> <i class="fas fa-user-circle"></i> </button>
            </div>
        </nav>

        <div id="landingPage" class="page-view" style="display: flex;">
            <div id="landingPageContainer">
                <div class="title">QUEST FOR <span>FOCUS</span></div>
                <div class="subtitle">Embark on your learning adventure! Conquer distractions, master knowledge.</div>
                <button data-action="show-view" data-view="signinForm" class="primary-btn">START QUEST</button>
                <button class="github-btn" data-action="github"><i class="fab fa-github"></i> GITHUB</button>
                <div id="features">
                    <div class="feature"><i class="fas fa-ban"></i><p>Ad-Free Zone<br>Focus!</p></div>
                    <div class="feature"><i class="fas fa-moon"></i><p>Dark Mode<br>Easy on eyes</p></div>
                    <div class="feature"><i class="fas fa-gamepad"></i><p>Gamified<br>Level up!</p></div>
                </div>
            </div>
        </div>

        <div id="signinForm" class="page-view">
            <div id="signinFormContainer">
                <div class="title">ENTER <span>REALM</span></div>
                <div class="subtitle">Log in or create hero profile.</div>
                <input type="text" id="username" placeholder="Username" required />
                <input type="password" id="password" placeholder="Secret Code" required />
                <button data-action="sign-in" class="primary-btn">SIGN IN</button>
                <button id="guestButton" class="github-btn">Sign in as Guest</button>
                <p style="color: var(--text-dim); margin-top: 15px;">New? <button data-action="create-account" class="accent-btn" style="margin-left: 5px; background: var(--secondary); box-shadow: 3px 3px 0 var(--primary-dark);">CREATE</button></p>
                
                <div style="margin-top:20px; border-top: 1px solid var(--primary-dark); padding-top: 20px;">
                    <div class="subtitle">Or use Supabase Login</div>
                    <input type="email" id="supabase-email" placeholder="Email" required />
                    <input type="password" id="supabase-password" placeholder="Password" required />
                    <button id="supabaseLoginBtn" class="primary-btn">Login with Email</button>
                    <button id="supabaseSignupBtn" class="accent-btn">Sign Up with Email</button>
                </div>

                <button data-action="show-view" data-view="landingPage" style="margin-top: 20px; background: var(--bg-light); font-size: 12px;"><i class="fas fa-arrow-left"></i> Back</button>
            </div>
        </div>

        <div id="homePage" class="page-view">
            <div id="homePageContent">
                <div id="welcomeMessage">Welcome, <span id="homeUsername">Hero</span>!</div>
                <div id="dateTimeDisplay">Loading...</div>
                <div id="upcomingTaskDisplay" class="none"><i class="fas fa-star"></i> No urgent quests!</div>
                <div id="focusStatus">Ready to focus?</div>
                <div id="motivationQuote">"Loading motivation..."</div>
            </div>
        </div>
        
        <div id="youtubeLecturePage" class="page-view">
            <div id="youtubeInputContainer">
                <div class="subtitle">Prepare Focus Session</div>
                <select id="playlistSelect"> <option value="">Load Playlist</option> </select>
                <div id="urlInputs">
                    <div class="url-container"> <input type="text" class="youtube-url" placeholder="YouTube URL (Video or Playlist)" required /> </div>
                </div>
                <button data-action="add-url"><i class="fas fa-plus"></i> Add URL</button>
                <div id="playlistManagement">
                    <input type="text" id="playlistName" placeholder="Save As..." />
                    <button data-action="save-playlist" class="primary-btn"><i class="fas fa-save"></i> Save</button>
                    <button data-action="remove-playlist" class="accent-btn" style="background: var(--danger); box-shadow: 3px 3px 0 #a71d2a;"><i class="fas fa-trash"></i> Delete</button>
                </div>
                <button data-action="start-playback" class="primary-btn"><i class="fas fa-play-circle"></i> BEGIN FOCUS</button>
            </div>
            <div id="playerContainer"><div id="player"></div></div>
            <button id="videoSidebarToggleBtn" title="Toggle List (T)"><i class="fas fa-list"></i></button>
            <div id="youtubeLecturePageControls"><button id="restartBtn" title="Exit Session"><i class="fas fa-times-circle"></i> Exit</button></div>
            <div id="videoSidebar"><h3><i class="fas fa-video"></i> Playlist</h3><div id="videoThumbnailList"></div></div>
        </div>
        
        <div id="profile" class="page-view">
            <div id="profileContainer">
                <div id="profileIcon"><i class="fas fa-user-shield"></i></div>
                <div id="profileUsername">Hero Name</div>
                <div class="profile-stat">Level: <span id="profileLevel" class="level">Mortal</span></div>
                <div class="profile-stat">XP: <span id="profileXP" class="xp">0</span></div>
                <div class="profile-stat">Streak: <span id="profileStreak" class="streak">0 days</span></div>
                <div id="profileSettings">
                    <h4><i class="fas fa-cog"></i> Settings</h4>
                    <div class="setting-item">
                        <label for="browserNotificationSetting">Enable Browser Notifications for Deadlines</label>
                        <input type="checkbox" id="browserNotificationSetting">
                    </div>
                    <small style="color: var(--text-dim); font-size: 12px; display: block; text-align: center; margin-top: -5px;">Requires browser permission.</small>
                </div>
                <button data-action="show-view" data-view="homePage" style="margin-top: 20px; background: var(--bg-light); font-size: 12px;"><i class="fas fa-arrow-left"></i> Home</button>
            </div>
        </div>

        <div id="focusStats" class="page-view">
            <div id="focusStatsContainer">
                <h3><i class="fas fa-chart-line"></i> Hero <span>Stats</span></h3>
                <div id="statsDisplay">
                    <div class="stat-item"><span class="label"><i class="fas fa-stopwatch"></i> Focus Time</span><span id="statsTotalFocusTime" class="value">0m</span></div>
                    <div class="stat-item"><span class="label"><i class="fas fa-eye-slash"></i> Distractions</span><span id="statsTotalDistractions" class="value distractions">0</span></div>
                    <div class="stat-item"><span class="label"><i class="fas fa-film"></i> Videos Done</span><span id="statsTotalVideosWatched" class="value videos">0</span></div>
                    <div class="stat-item"><span class="label"><i class="fas fa-fire"></i> Current Streak</span><span id="statsCurrentStreak" class="value streak">0 days</span></div>
                </div>
                <div id="focusCalendar">
                    <div id="calendarHeader">
                        <button id="prevMonthBtn"><i class="fas fa-chevron-left"></i></button>
                        <h4 id="calendarMonthYear"><i class="fas fa-calendar-alt"></i> Calendar</h4>
                        <button id="nextMonthBtn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div id="calendarGrid"></div>
                </div>
                <button data-action="show-view" data-view="homePage" style="margin-top: 30px; background: var(--bg-light); font-size: 12px; display: block; margin-left: auto; margin-right: auto;"><i class="fas fa-arrow-left"></i> Home</button>
            </div>
        </div>

        <div id="pyqEmbedPage" class="page-view" style="display:none;">
            <div id="pyqToolbar" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <button id="pyqBackBtn" class="accent-btn" style="background: var(--bg-light);"><i class="fas fa-arrow-left"></i> Back</button>
                <span style="color: var(--text-dim); font-size: 14px;"><i class="fas fa-dumbbell"></i> PYQs</span>
                <span></span>
            </div>
            <div id="pyqEmbedContainer">
                <iframe id="pyqIframe" title="ExamGoal PYQs" src="about:blank" loading="lazy" referrerpolicy="no-referrer" allow="clipboard-read; clipboard-write; fullscreen" style="width:100%;height:100%;border:0;background:#111;"></iframe>
                <div id="pyqFallback" style="display:none;position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:20px;text-align:center;background:rgba(26,26,46,0.9);border:2px dashed var(--danger);border-radius:8px;">
                    <div>
                        <h3 style="color: var(--danger); margin-bottom:10px;"><i class="fas fa-ban"></i> Embedding blocked</h3>
                        <p style="color: var(--text);">room.examgoal.com disallows embedding in an iframe. You can open it in a new tab:</p>
                        <p style="margin-top:10px;"><a href="https://room.examgoal.com/" target="_blank" rel="noreferrer" style="color: var(--accent); text-decoration: underline;">Open PYQs</a></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar-trigger" title="Open Menu">MENU</div>
        <div class="game-sidebar">
            <div class="sidebar-section"><h3>Navigation</h3><button data-action="show-view" data-view="homePage"><i class="fas fa-home"></i> Home</button><button data-action="show-view" data-view="youtubeLecturePage"><i class="fab fa-youtube"></i> Lectures</button><button data-action="toggle-todo"><i class="fas fa-list-check"></i> To-Do<span id="todoBadge" class="todo-badge">0</span></button></div>
            <div class="sidebar-section"><h3>Progress</h3><button data-action="show-view" data-view="focusStats"><i class="fas fa-chart-line"></i> Stats</button><button id="pyqOpenBtn"><i class="fas fa-dumbbell"></i> PYQs</button></div>
            <div class="sidebar-section"><h3>Self Study</h3><button id="quietPomodoroBtn"><i class="fas fa-brain"></i> Pomodoro</button></div>
            <div class="sidebar-section"><h3>Shops & Realms</h3><button id="streakShieldBtn"><i class="fas fa-shield-alt"></i> Shield</button><button id="doublePointsBtn"><i class="fas fa-bolt"></i> Double XP</button><button id="audioStoreBtn"><i class="fas fa-music"></i> Audio</button><a href="https://forestquest.vercel.app/" target="_blank" rel="noreferrer"><i class="fas fa-tree"></i> Forest</a><a href="https://focuswithpomodoro.netlify.app/" target="_blank" rel="noreferrer"><i class="fas fa-clock"></i> Pomodoro Realm</a><a href="https://the-chosen-one-o5.github.io/Daily-Schedule/" target="_blank" rel="noreferrer"><i class="fas fa-calendar-alt"></i> Planner</a></div>
            <div class="sidebar-section"><h3>Account</h3><button data-action="show-view" data-view="profile"><i class="fas fa-user"></i> Profile</button><button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button></div>
        </div>
        <div id="timerDisplay"><span id="timerText">Focus: 00:00</span><div id="progressBar"><div id="progressFill"></div></div></div>
        <div id="pointsDisplay"><span style="color: var(--secondary);">⭐</span> XP: 0</div>
        <div id="achievementLevel">Mortal</div>
        <div id="todoList"><h3><i class="fas fa-tasks"></i> Quests</h3><div id="tasks"></div><div class="dialog-buttons"><button data-action="save-tasks" class="primary-btn"><i class="fas fa-save"></i> Save</button><button data-action="add-task-line" style="background: var(--bg-light);"><i class="fas fa-plus"></i> Add</button><button data-action="close-todo" class="accent-btn" style="background: var(--danger); box-shadow: 3px 3px 0 #a71d2a;"><i class="fas fa-times"></i> Close</button></div></div>
        <div id="lofiPlayer"><div class="lofi-title">LOFI ♬</div><button id="lofiPrev" title="Prev"><i class="fas fa-backward-step"></i></button><button id="lofiPlay" title="Play"><i class="fas fa-play"></i></button><button id="lofiPause" title="Pause"><i class="fas fa-pause"></i></button><button id="lofiNext" title="Next"><i class="fas fa-forward-step"></i></button></div>
        <div id="fireBox" title="AI Assistant"><i class="fas fa-robot"></i></div>
        <div id="aiPopup"><iframe src="https://www.chatbase.co/chatbot-iframe/3dSdpryiYZlWipHUL8dNK" frameBorder="0"></iframe></div>
        <div id="achievementOverlay">LEVEL UP!</div>
        <div id="confirmationDialog" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-question-circle"></i> Confirm</h3><p id="confirmationDialogText">Are you sure?</p><div class="dialog-buttons"><button id="confirmBtn">YES</button><button id="cancelBtn">NO</button></div></div></div>
        <div id="streakShieldDialog" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-shield-alt"></i> Shield</h3><p>Protect streak (1 week)? Costs 800 XP.</p><div class="dialog-buttons"><button id="streakShieldConfirmBtn">Buy</button><button id="streakShieldCancelBtn">Cancel</button></div></div></div>
        <div id="doublePointsDialog" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-bolt"></i> Double XP</h3><p>Activate Double XP (24h)? Costs 800 XP.</p><div class="dialog-buttons"><button id="doublePointsConfirmBtn">Activate</button><button id="doublePointsCancelBtn">Cancel</button></div></div></div>
        <div id="deadlineDialog" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-calendar-check"></i> Deadline</h3><p>Set deadline & difficulty for bonus XP!</p><input type="date" id="deadlineDate" /><input type="time" id="deadlineTime" /><select id="taskDifficulty"><option value="50">Easy (+50)</option><option value="100">Medium (+100)</option><option value="200">Hard (+200)</option><option value="300">Very Hard (+300)</option></select><div class="dialog-buttons"><button id="deadlineConfirmBtn">Set</button><button id="deadlineCancelBtn">Cancel</button></div></div></div>
        <div id="sessionCompleteDialog" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-check-circle"></i> Session Done!</h3><p>Great focus!</p><p>Continue for +100 XP bonus?</p><div class="dialog-buttons"><button id="sessionContinueBtn">Continue</button><button id="sessionEndBtn">End</button></div></div></div>
        <div id="mysteryBoxPopup" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-gift"></i> Mystery Box</h3><p id="mysteryRewardText">Mystery box earned!</p><div class="dialog-buttons"><button id="openMysteryBox">Open</button><button id="closeMysteryBoxBtn">Later</button></div></div></div>
        <div id="audioTracksStore" class="dialog-overlay"><div class="dialog-box"><h3><i class="fas fa-store"></i> Audio Store</h3><p>Unlock Lo-Fi tracks!</p><div id="audioTracksList"></div><div class="dialog-buttons" style="margin-top: 20px;"><button id="closeAudioStore">Close</button></div></div></div>
        <div id="pomodoroOverlay" class="dialog-overlay">
            <div id="pomodoroContainer">
                <h3><i class="fas fa-brain"></i> POMODORO</h3>
                <p>Focus deeply. Earn 1 XP per minute.</p>
                <div id="pomodoroDurationSetting"><label for="pomodoroDurationInput">Duration (min):</label><input type="number" id="pomodoroDurationInput" value="60" min="1" max="180"></div>
                <div id="pomodoroTimer">60:00</div>
                <div id="pomodoroStatus">Ready</div>
                <div id="pomodoroControls"><button id="pomodoroStartBtn"><i class="fas fa-play"></i> START</button><button id="pomodoroResetBtn"><i class="fas fa-redo"></i> RESET</button><button id="pomodoroCloseBtn"><i class="fas fa-times"></i> CLOSE</button></div>
            </div>
        </div>

        <audio id="focusAudio" preload="metadata" src="https://the-chosen-one-o5.github.io/UltraFocusModeYT/focus.mp3" loop></audio>
        <audio id="lofiAudio" preload="metadata" loop></audio>
        <audio id="pomodoroCompleteAudio" preload="none" src="https://www.dropbox.com/scl/fi/ihrcv1s3o4m4abhn6oa5z/level-up-4-243762.mp3?rlkey=qkaf4zrhipxtxpu51an0do45r&st=boipxpb5&dl=1"></audio>
        <audio id="levelUpAudio" preload="none" src="https://www.dropbox.com/scl/fi/ykeun00q1t03kzpeow819/music-to-make-your-brain-shut-up-a-dark-academia-playlist-4.mp3?rlkey=3hnw2vk2ck0yjnr9oekk2xqld&st=hh77z1k0&dl=1"></audio>
        <audio id="achievementAudio" preload="none" src="https://www.dropbox.com/scl/fi/pe09xx1c680gzymsa2gdf/NEOTIC-Calm-Your-Anxiety.mp3?rlkey=2hp7su9j541mpcdkw4ccavx58&st=yles1d&dl=1"></audio>

    </div>
    <script src="script.js"></script>

</body>
</html>


