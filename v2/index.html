<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Mode YouTube Player</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #4169e1;
      --primary-dark: #1e3a8a;
      --secondary: #8e2de2;
      --accent: #ff4500;
      --accent-alt: #ff8c00;
      --bg-dark: #0f0f1b;
      --bg-medium: #1a1a2e;
      --bg-light: #252538;
      --text: #e0e0ff;
      --text-dim: #9090b0;
    }

    body {
      background-color: var(--bg-dark);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: monospace;
      color: var(--text);
      overflow: hidden;
      font-size: 18px;
      line-height: 1.4;
    }

    .game-container {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
      background-image: radial-gradient(circle at 10% 20%, rgba(142, 45, 226, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(65, 105, 225, 0.1) 0%, transparent 20%),
        linear-gradient(to bottom, var(--bg-dark), var(--bg-medium));
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1;
    }

    .game-container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 5v1H5V0zm1 5v1H5v-1h1z'/%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 2;
    }

    #landingPage,
    #signinForm,
    #inputForm {
      text-align: center;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
      z-index: 10;
      background-color: rgba(15, 15, 27, 0.8);
      border: 2px solid var(--secondary);
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(142, 45, 226, 0.3);
      pointer-events: auto;
    }

    .title {
      font-family: monospace;
      font-size: 32px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      text-shadow: 3px 3px 0px var(--primary-dark);
      letter-spacing: 2px;
    }

    .title span {
      color: var(--secondary);
      position: relative;
      display: inline-block;
    }

    .title span::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }

    .subtitle {
      font-size: 20px;
      color: var(--text-dim);
      margin-bottom: 30px;
    }

    button {
      display: inline-block;
      padding: 12px 30px;
      font-size: 18px;
      font-family: monospace;
      font-weight: 600;
      background: var(--secondary);
      border: none;
      color: var(--text);
      border-radius: 0;
      cursor: pointer;
      margin: 0 10px 15px;
      transition: all 0.3s;
      position: relative;
      box-shadow: 4px 4px 0 var(--primary-dark);
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 1px;
      z-index: 11;
      pointer-events: auto;
    }

    button:hover {
      background: var(--primary);
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--primary-dark);
    }

    button:active {
      transform: translate(4px, 4px);
      box-shadow: none;
    }

    .github-btn {
      background: var(--bg-light);
      box-shadow: 4px 4px 0 var(--bg-medium);
    }

    .github-btn:hover {
      background: var(--bg-medium);
      box-shadow: 2px 2px 0 var(--bg-medium);
    }

    #features {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 40px;
      flex-wrap: wrap;
      z-index: 10;
    }

    .feature {
      background: var(--bg-light);
      padding: 15px 20px;
      border-radius: 0;
      width: 200px;
      box-shadow: 4px 4px 0 var(--bg-medium);
      border: 2px solid var(--primary);
      position: relative;
      overflow: hidden;
      z-index: 10;
    }

    .feature::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    .feature i {
      font-size: 24px;
      color: var(--secondary);
      margin-bottom: 10px;
    }

    .feature p {
      font-size: 16px;
      color: var(--text);
    }

    input,
    select {
      display: block;
      width: 100%;
      max-width: 320px;
      margin: 10px auto;
      padding: 12px;
      border-radius: 0;
      font-size: 16px;
      font-family: monospace;
      background: var(--bg-light);
      border: 2px solid var(--primary);
      color: var(--text);
      outline: none;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.2);
      z-index: 11;
      pointer-events: auto;
    }

    input:focus,
    select:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 2px rgba(142, 45, 226, 0.3);
    }

    #inputForm {
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--secondary) var(--bg-medium);
    }

    #inputForm::-webkit-scrollbar {
      width: 8px;
    }

    #inputForm::-webkit-scrollbar-track {
      background: var(--bg-medium);
    }

    #inputForm::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 0;
      border: 2px solid var(--bg-medium);
    }

    #player {
      width: 100%;
      max-width: 1200px;
      aspect-ratio: 16 / 9;
      border-radius: 0;
      overflow: hidden;
      display: none;
      background: #000;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px rgba(65, 105, 225, 0.5);
      z-index: 5;
    }

    #timerDisplay {
      position: fixed;
      top: 10px;
      left: 10px;
      color: var(--text);
      font-size: 24px;
      z-index: 101;
      cursor: move;
      padding: 10px;
      background: var(--bg-medium);
      border: 2px solid var(--primary);
      font-family: monospace;
      font-size: 16px;
      pointer-events: auto;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    #timerDisplay button {
      pointer-events: auto;
      padding: 5px 10px;
      margin: 0 5px;
      font-size: 12px;
      z-index: 102;
    }

    #pointsDisplay {
      position: fixed;
      top: 50px;
      left: 10px;
      font-size: 18px;
      color: var(--text);
      font-family: monospace;
      font-weight: 600;
      z-index: 101;
      background: var(--bg-medium);
      padding: 8px 12px;
      border: 2px solid var(--secondary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: none;
    }

    #clockDisplay {
      position: fixed;
      top: 90px;
      left: 10px;
      font-size: 20px;
      font-family: monospace;
      font-weight: bold;
      z-index: 101;
      padding: 8px 12px;
      background: var(--bg-medium);
      border: 2px solid var(--primary);
      display: none;
      pointer-events: none;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    #clockDisplay .time {
      color: var(--primary);
      font-weight: 600;
      text-shadow: 3px 3px 0px var(--primary-dark);
      letter-spacing: 2px;
    }

    #clockDisplay .period {
      color: var(--secondary);
      font-weight: 600;
      text-shadow: 3px 3px 0px var(--primary-dark);
      letter-spacing: 2px;
    }

    #progressBar {
      width: 200px;
      height: 10px;
      background: var(--bg-light);
      display: none;
      margin-top: 5px;
      border: 2px solid var(--primary);
      z-index: 101;
    }

    #progressFill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    #sitesBox {
      display: none;
      position: fixed;
      top: 130px;
      left: 10px;
      z-index: 101;
      padding: 8px 12px;
      background: var(--bg-medium);
      border: 2px solid var(--primary);
      cursor: pointer;
      pointer-events: auto;
    }

    #sitesPopup {
      position: fixed;
      top: 170px;
      left: 10px;
      width: 250px;
      background: var(--bg-medium);
      padding: 15px;
      border: 2px solid var(--secondary);
      display: none;
      z-index: 102;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }

    #sitesPopup a {
      display: block;
      color: var(--primary);
      text-decoration: none;
      margin: 10px 0;
      font-size: 14px;
      font-family: monospace;
      padding: 5px;
      border: 1px solid var(--primary);
      transition: all 0.3s;
      pointer-events: auto;
    }

    #sitesPopup a:hover {
      color: var(--text);
      background: var(--primary);
      transform: translate(2px, 2px);
    }

    #closeSitesPopup {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--accent);
      border: none;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      padding: 2px 6px;
      margin: 0;
      z-index: 103;
    }

    #restartBtn {
      display: none;
      position: fixed;
      top: 10px;
      right: 10px;
      background: var(--accent);
      z-index: 103;
      pointer-events: auto;
    }

    #videoSidebar {
      position: fixed;
      right: -320px;
      top: 0;
      width: 300px;
      height: 100%;
      background: var(--bg-medium);
      transition: right 0.3s ease;
      padding: 20px;
      overflow-y: auto;
      z-index: 102;
      border-left: 4px solid var(--primary);
      pointer-events: auto;
    }

    .thumbnail {
      width: 100%;
      margin-bottom: 15px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 0;
      transition: all 0.3s;
      image-rendering: pixelated;
      pointer-events: auto;
    }

    .thumbnail:hover {
      border-color: var(--secondary);
      transform: scale(1.05);
    }

    #minimizeBtn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--accent);
      border: none;
      color: var(--text);
      cursor: pointer;
      font-size: 14px;
      padding: 2px 6px;
      margin: 0;
      box-shadow: none;
      z-index: 102;
    }

    .url-container {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .url-container button {
      margin-left: 10px;
      padding: 5px 10px;
      background: var(--accent);
      font-size: 14px;
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
      z-index: 11;
    }

    #statsBtn,
    #todoBtn,
    #pyqBtn {
      padding: 8px 16px;
      font-size: 12px;
      margin: 0 5px 15px;
      z-index: 11;
    }

    #analytics,
    #todoList {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-medium);
      padding: 20px;
      border: 2px solid var(--secondary);
      display: none;
      z-index: 100;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
      transition: all 0.3s ease;
    }

    #analytics {
      top: 90px;
      width: 300px;
    }

    #todoList {
      top: 50px;
      width: 300px;
      max-height: 400px;
    }

    #todoList.expanded {
      width: 80vw;
      max-width: 1000px;
      height: 80vh;
      max-height: 800px;
      top: 10vh;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(26, 26, 46, 0.95);
      border: 4px solid var(--secondary);
      box-shadow: 0 0 30px rgba(142, 45, 226, 0.5);
      z-index: 150;
    }

    #tasks {
      overflow-y: auto;
      max-height: 320px;
      margin-bottom: 10px;
      background: none;
    }

    #todoList.expanded #tasks {
      max-height: 70vh;
      padding: 10px;
    }

    #analytics h3,
    #todoList h3 {
      font-size: 20px;
      margin-bottom: 10px;
      color: var(--secondary);
      font-family: monospace;
      text-align: center;
    }

    #analytics p {
      font-size: 16px;
      margin: 5px 0;
      border-bottom: 1px solid var(--text-dim);
      padding-bottom: 5px;
    }

    .task-line {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      background: var(--bg-light);
      padding: 5px;
      border: 1px solid var(--primary);
      pointer-events: auto;
    }

    #todoList.expanded .task-line {
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 4px;
    }

    .task-line input[type="text"] {
      flex-grow: 1;
      font-size: 16px;
      font-family: monospace;
      color: var(--text);
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--text-dim);
      padding: 2px 0;
      outline: none;
      box-shadow: none;
      margin: 0;
      pointer-events: auto;
      z-index: 11;
    }

    #todoList.expanded .task-line input[type="text"] {
      font-size: 18px;
      padding: 5px 0;
    }

    .task-line input[type="text"]:focus {
      border-bottom: 1px solid var(--secondary);
      box-shadow: none;
    }

    .task-line .remove-task {
      margin-left: 10px;
      color: var(--accent);
      font-size: 16px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      line-height: 1;
      pointer-events: auto;
      z-index: 11;
    }

    .task-line .set-deadline {
      margin-left: 5px;
      color: var(--primary);
      font-size: 14px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 2px 5px;
      border: 1px solid var(--primary);
      pointer-events: auto;
      z-index: 11;
    }

    .task-line .set-deadline:hover {
      background: var(--primary);
      color: var(--text);
    }

    .task-line .deadline-info {
      margin-left: 5px;
      font-size: 12px;
      color: var(--accent-alt);
    }

    #todoList.expanded .task-line .deadline-info {
      font-size: 14px;
    }

    .task-line .points-info {
      margin-left: 5px;
      font-size: 12px;
      color: var(--secondary);
    }

    #todoList.expanded .task-line .points-info {
      font-size: 14px;
    }

    /* Neon Checkbox Styles */
    .neon-checkbox {
      --primary: #00ffaa;
      --primary-dark: #00cc88;
      --primary-light: #88ffdd;
      --size: 30px;
      position: relative;
      width: var(--size);
      height: var(--size);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    #todoList.expanded .neon-checkbox {
      --size: 40px;
    }

    .neon-checkbox input {
      display: none;
    }

    .neon-checkbox__frame {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .neon-checkbox__box {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 4px;
      border: 2px solid var(--primary-dark);
      transition: all 0.4s ease;
    }

    .neon-checkbox__check-container {
      position: absolute;
      inset: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .neon-checkbox__check {
      width: 80%;
      height: 80%;
      fill: none;
      stroke: var(--primary);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 40;
      stroke-dashoffset: 40;
      transform-origin: center;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .neon-checkbox__glow {
      position: absolute;
      inset: -2px;
      border-radius: 6px;
      background: var(--primary);
      opacity: 0;
      filter: blur(8px);
      transform: scale(1.2);
      transition: all 0.4s ease;
    }

    .neon-checkbox__borders {
      position: absolute;
      inset: 0;
      border-radius: 4px;
      overflow: hidden;
    }

    .neon-checkbox__borders span {
      position: absolute;
      width: 40px;
      height: 1px;
      background: var(--primary);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .neon-checkbox__borders span:nth-child(1) {
      top: 0;
      left: -100%;
      animation: borderFlow1 2s linear infinite;
    }

    .neon-checkbox__borders span:nth-child(2) {
      top: -100%;
      right: 0;
      width: 1px;
      height: 40px;
      animation: borderFlow2 2s linear infinite;
    }

    .neon-checkbox__borders span:nth-child(3) {
      bottom: 0;
      right: -100%;
      animation: borderFlow3 2s linear infinite;
    }

    .neon-checkbox__borders span:nth-child(4) {
      bottom: -100%;
      left: 0;
      width: 1px;
      height: 40px;
      animation: borderFlow4 2s linear infinite;
    }

    .neon-checkbox__particles span {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--primary);
      border-radius: 50%;
      opacity: 0;
      pointer-events: none;
      top: 50%;
      left: 50%;
      box-shadow: 0 0 6px var(--primary);
    }

    .neon-checkbox__rings {
      position: absolute;
      inset: -20px;
      pointer-events: none;
    }

    .neon-checkbox__rings .ring {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 1px solid var(--primary);
      opacity: 0;
      transform: scale(0);
    }

    .neon-checkbox__sparks span {
      position: absolute;
      width: 20px;
      height: 1px;
      background: linear-gradient(90deg, var(--primary), transparent);
      opacity: 0;
    }

    .neon-checkbox:hover .neon-checkbox__box {
      border-color: var(--primary);
      transform: scale(1.05);
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__box {
      border-color: var(--primary);
      background: rgba(0, 255, 170, 0.1);
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__check {
      stroke-dashoffset: 0;
      transform: scale(1.1);
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__glow {
      opacity: 0.2;
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__borders span {
      opacity: 1;
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__particles span {
      animation: particleExplosion 0.6s ease-out forwards;
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__rings .ring {
      animation: ringPulse 0.6s ease-out forwards;
    }

    .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__sparks span {
      animation: sparkFlash 0.6s ease-out forwards;
    }

    @keyframes borderFlow1 {
      0% { transform: translateX(0); }
      100% { transform: translateX(200%); }
    }

    @keyframes borderFlow2 {
      0% { transform: translateY(0); }
      100% { transform: translateY(200%); }
    }

    @keyframes borderFlow3 {
      0% { transform: translateX(0); }
      100% { transform: translateX(-200%); }
    }

    @keyframes borderFlow4 {
      0% { transform: translateY(0); }
      100% { transform: translateY(-200%); }
    }

    @keyframes particleExplosion {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
      20% { opacity: 1; }
      100% { transform: translate(calc(-50% + var(--x, 20px)), calc(-50% + var(--y, 20px))) scale(0); opacity: 0; }
    }

    @keyframes ringPulse {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    @keyframes sparkFlash {
      0% { transform: rotate(var(--r, 0deg)) translateX(0) scale(1); opacity: 1; }
      100% { transform: rotate(var(--r, 0deg)) translateX(30px) scale(0); opacity: 0; }
    }

    .neon-checkbox__particles span:nth-child(1) { --x: 25px; --y: -25px; }
    .neon-checkbox__particles span:nth-child(2) { --x: -25px; --y: -25px; }
    .neon-checkbox__particles span:nth-child(3) { --x: 25px; --y: 25px; }
    .neon-checkbox__particles span:nth-child(4) { --x: -25px; --y: 25px; }
    .neon-checkbox__particles span:nth-child(5) { --x: 35px; --y: 0px; }
    .neon-checkbox__particles span:nth-child(6) { --x: -35px; --y: 0px; }
    .neon-checkbox__particles span:nth-child(7) { --x: 0px; --y: 35px; }
    .neon-checkbox__particles span:nth-child(8) { --x: 0px; --y: -35px; }
    .neon-checkbox__particles span:nth-child(9) { --x: 20px; --y: -30px; }
    .neon-checkbox__particles span:nth-child(10) { --x: -20px; --y: 30px; }
    .neon-checkbox__particles span:nth-child(11) { --x: 30px; --y: 20px; }
    .neon-checkbox__particles span:nth-child(12) { --x: -30px; --y: -20px; }

    .neon-checkbox__sparks span:nth-child(1) { --r: 0deg; top: 50%; left: 50%; }
    .neon-checkbox__sparks span:nth-child(2) { --r: 90deg; top: 50%; left: 50%; }
    .neon-checkbox__sparks span:nth-child(3) { --r: 180deg; top: 50%; left: 50%; }
    .neon-checkbox__sparks span:nth-child(4) { --r: 270deg; top: 50%; left: 50%; }

    .neon-checkbox__rings .ring:nth-child(1) { animation-delay: 0s; }
    .neon-checkbox__rings .ring:nth-child(2) { animation-delay: 0.1s; }
    .neon-checkbox__rings .ring:nth-child(3) { animation-delay: 0.2s; }

    #achievementOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      color: gold;
      font-size: 32px;
      font-weight: bold;
      z-index: 104;
      display: none;
      font-family: monospace;
      text-align: center;
      text-shadow: 3px 3px 0 var(--primary-dark);
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
    }

    #achievementLevel {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 20px;
      font-weight: bold;
      z-index: 101;
      font-family: monospace;
      background: var(--bg-medium);
      padding: 8px 12px;
      border: 2px solid var(--secondary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: none;
    }

    #streakDisplay {
      position: fixed;
      top: 60px;
      right: 10px;
      font-size: 16px;
      color: var(--text);
      z-index: 101;
      background: var(--bg-medium);
      padding: 8px 12px;
      border: 2px solid var(--secondary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: none;
      font-family: monospace;
    }

    .glow {
      text-shadow: 0 0 10px var(--text);
      animation: pulse 2s infinite;
    }

    .box-glow {
      border: 2px solid gold;
      padding: 5px;
      box-shadow: 0 0 10px gold;
      animation: pulse 2s infinite;
    }

    .rainbow {
      background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbow 3s infinite;
    }

    @keyframes rainbow {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    #confirmationDialog,
    #streakShieldDialog,
    #doublePointsDialog,
    #deadlineDialog,
    #sessionCompleteDialog {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-medium);
      padding: 20px;
      border: 4px solid var(--accent);
      box-shadow: 0 0 20px rgba(255, 69, 0, 0.5);
      z-index: 105;
      display: none;
      text-align: center;
      pointer-events: auto;
      font-family: monospace;
    }

    #confirmationDialog p,
    #streakShieldDialog p,
    #doublePointsDialog p,
    #deadlineDialog p,
    #sessionCompleteDialog p {
      font-size: 16px;
      margin-bottom: 20px;
    }

    #confirmationDialog button,
    #streakShieldDialog button,
    #doublePointsDialog button,
    #deadlineDialog button,
    #sessionCompleteDialog button {
      padding: 8px 20px;
      margin: 0 10px;
      font-size: 14px;
      pointer-events: auto;
      z-index: 106;
    }

    #confirmBtn,
    #streakShieldConfirmBtn,
    #doublePointsConfirmBtn,
    #deadlineConfirmBtn,
    #sessionContinueBtn {
      background: var(--accent);
    }

    #cancelBtn,
    #streakShieldCancelBtn,
    #doublePointsCancelBtn,
    #deadlineCancelBtn,
    #sessionEndBtn {
      background: var(--primary);
    }

    #deadlineDialog input,
    #deadlineDialog select {
      margin: 10px auto;
      width: 100%;
      max-width: 250px;
    }

    #pdfToggle {
      display: none;
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: var(--primary);
      z-index: 101;
      cursor: pointer;
      pointer-events: auto;
    }

    #pdfViewer {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      height: 500px;
      background: var(--bg-medium);
      padding: 15px;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px rgba(65, 105, 225, 0.5);
      z-index: 101;
      pointer-events: auto;
    }

    #pdfInput {
      margin-bottom: 10px;
      width: 100%;
      pointer-events: auto;
      z-index: 102;
    }

    #pdfFrame {
      width: 100%;
      height: 90%;
      border: none;
      background: #fff;
    }

    #fireBox {
      position: fixed;
      bottom: 10px;
      left: 10px;
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      cursor: pointer;
      z-index: 100;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      border: 2px solid var(--secondary);
      pointer-events: auto;
    }

    #fireBox:hover {
      background: var(--secondary);
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
    }

    #aiPopup {
      position: fixed;
      bottom: 60px;
      left: 10px;
      width: 300px;
      height: 400px;
      background: var(--bg-medium);
      border-radius: 0;
      padding: 5px;
      display: none;
      z-index: 101;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      border: 4px solid var(--primary);
      pointer-events: auto;
    }

    #aiPopup iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .game-sidebar {
      position: fixed;
      left: -250px;
      top: 0;
      width: 250px;
      height: 100vh;
      background: var(--bg-medium);
      border-right: 4px solid var(--primary);
      z-index: 200;
      transition: left 0.3s ease;
      padding: 20px 0;
      box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3);
      overflow-y: auto;
      pointer-events: auto;
    }

    .sidebar-trigger:hover + .game-sidebar,
    .game-sidebar:hover {
      left: 0;
    }

    .sidebar-trigger {
      position: fixed;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 80px;
      background: var(--primary);
      z-index: 199;
      border-radius: 0 5px 5px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      font-weight: bold;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-size: 12px;
      letter-spacing: 1px;
      pointer-events: auto;
    }

    .sidebar-section {
      padding: 15px;
      border-bottom: 2px solid var(--bg-dark);
    }

    .sidebar-section h3 {
      color: var(--secondary);
      font-size: 16px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .sidebar-section a,
    .sidebar-section button {
      display: block;
      width: 100%;
      padding: 8px 10px;
      margin: 5px 0;
      background: var(--bg-light);
      color: var(--text);
      border: 1px solid var(--primary);
      text-align: left;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      pointer-events: auto;
      z-index: 201;
    }

    .sidebar-section a:hover,
    .sidebar-section button:hover {
      background: var(--primary);
      transform: translateX(5px);
    }

    .dashboard-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .dashboard-info p {
      font-size: 14px;
      display: flex;
      justify-content: space-between;
    }

    .dashboard-info p span:first-child {
      font-weight: bold;
      color: var(--primary);
    }

    #mysteryBoxPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-medium);
      padding: 20px;
      border: 4px solid gold;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      z-index: 105;
      display: none;
      text-align: center;
      pointer-events: auto;
      font-family: monospace;
      width: 300px;
    }

    #mysteryBoxPopup h3 {
      color: gold;
      font-size: 20px;
      margin-bottom: 15px;
    }

    #mysteryBoxPopup p {
      font-size: 16px;
      margin-bottom: 20px;
    }

    #mysteryBoxPopup button {
      padding: 8px 20px;
      background: var(--accent);
      font-size: 14px;
      pointer-events: auto;
    }

    #audioTracksStore {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      max-height: 500px;
      background: var(--bg-medium);
      padding: 20px;
      border: 4px solid var(--secondary);
      box-shadow: 0 0 20px rgba(142, 45, 226, 0.5);
      z-index: 105;
      display: none;
      text-align: center;
      pointer-events: auto;
      font-family: monospace;
      overflow-y: auto;
    }

    #audioTracksStore h3 {
      color: var(--secondary);
      font-size: 20px;
      margin-bottom: 15px;
    }

    .audio-track-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      margin-bottom: 10px;
      background: var(--bg-light);
      border: 1px solid var(--primary);
    }

    .audio-track-item.locked .track-name {
      color: var(--text-dim);
    }

    .audio-track-item.unlocked .track-name {
      color: var(--accent-alt);
    }

    .unlock-track-btn {
      padding: 5px 10px;
      background: var(--secondary);
      font-size: 12px;
      margin: 0;
    }

    .unlock-track-btn:disabled {
      background: var(--bg-light);
      color: var(--text-dim);
      cursor: not-allowed;
    }

    #pomodoroOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 15, 27, 0.9);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      pointer-events: auto;
    }

    #pomodoroContainer {
      width: 400px;
      background: var(--bg-medium);
      padding: 30px;
      border: 4px solid var(--secondary);
      box-shadow: 0 0 30px rgba(142, 45, 226, 0.5);
      text-align: center;
      pointer-events: auto;
    }

    #pomodoroTimer {
      font-size: 80px;
      font-weight: bold;
      color: var(--text);
      margin: 20px 0;
      font-family: monospace;
    }

    #pomodoroControls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    #pomodoroControls button {
      padding: 10px 25px;
      font-size: 16px;
    }

    #pomodoroStatus {
      font-size: 18px;
      color: var(--accent-alt);
      margin-top: 15px;
    }

    #lofiPlayer {
      position: fixed;
      bottom: 60px;
      right: 10px;
      background: var(--bg-medium);
      padding: 10px;
      border: 2px solid var(--secondary);
      z-index: 101;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
      display: none;
    }

    .lofi-player {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .title-box {
      text-align: center;
    }

    .title-1 {
      font-size: 14px;
      color: var(--text);
      font-family: monospace;
    }

    .title-2 {
      font-size: 12px;
      color: var(--text-dim);
      font-family: monospace;
    }

    .controls {
      display: flex;
      gap: 10px;
    }

    .controls button {
      background: var(--primary);
      border: none;
      padding: 5px;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }

    .controls button:hover {
      background: var(--secondary);
      transform: translate(1px, 1px);
      box-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
    }

    @media (max-width: 800px) {
      .title { font-size: 24px; }
      button { padding: 8px 16px; font-size: 12px; margin: 0 5px 10px; }
      #features { flex-direction: column; align-items: center; }
      .feature { width: 90%; max-width: 250px; }
      #timerDisplay, #pointsDisplay, #clockDisplay, #sitesBox { font-size: 14px; padding: 5px 8px; }
      #achievementLevel, #streakDisplay { font-size: 14px; padding: 5px 8px; }
      #videoSidebar { width: 250px; }
      #confirmationDialog, #streakShieldDialog, #doublePointsDialog { width: 90%; max-width: 300px; }
      #confirmationDialog p, #streakShieldDialog p, #doublePointsDialog p { font-size: 14px; }
      #pdfViewer { width: 90%; height: 80%; max-height: 500px; }
      #aiPopup { width: 90%; max-width: 300px; height: 350px; }
      #mysteryBoxPopup { width: 90%; max-width: 280px; }
      #audioTracksStore { width: 90%; max-width: 350px; }
      #pomodoroContainer { width: 90%; max-width: 350px; padding: 20px; }
      #pomodoroTimer { font-size: 60px; }
      #todoList.expanded { width: 90vw; height: 90vh; top: 5vh; }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="sidebar-trigger">MENU</div>
    <div class="game-sidebar">
      <div class="sidebar-section">
        <h3>Dashboard</h3>
        <div class="dashboard-info">
          <p><span>Hero:</span> <span id="sidebarUsername">Guest</span></p>
          <p><span>Level:</span> <span id="sidebarLevel">Mortal</span></p>
          <p><span>XP:</span> <span id="sidebarXP">0</span></p>
          <p><span>Streak:</span> <span id="sidebarStreak">0 days</span></p>
        </div>
      </div>
      <div class="sidebar-section">
        <h3>Allied Realms</h3>
        <a href="https://forestquest.vercel.app/" target="_blank" rel="noreferrer">FOREST QUEST - TASK MANAGEMENT</a>
        <a href="https://focuswithpomodoro.netlify.app/" target="_blank" rel="noreferrer">POMODORO REALM</a>
        <a href="https://the-chosen-one-o5.github.io/Daily-Schedule/" target="_blank" rel="noreferrer">DAILY QUEST PLANNER</a>
      </div>
      <div class="sidebar-section">
        <h3>Self Study</h3>
        <button id="quietPomodoroBtn">QUIET POMODORO</button>
      </div>
      <div class="sidebar-section">
        <h3>Shops</h3>
        <button id="streakShieldBtn">STREAK SHIELD</button>
        <button id="doublePointsBtn">DOUBLE POINTS POWER-UP</button>
        <button id="audioStoreBtn">AUDIO TRACKS STORE</button>
      </div>
      <div class="sidebar-section">
        <h3>Account</h3>
        <button id="logoutBtn">LOGOUT</button>
      </div>
    </div>
    <div id="landingPage">
      <div class="title">QUEST FOR <span>FOCUS</span></div>
      <div class="subtitle">Begin your learning adventure!</div>
      <button data-action="start-game">START GAME</button>
      <button class="github-btn" data-action="github">GITHUB REPO</button>
      <div id="features">
        <div class="feature">
          <i class="fas fa-ad"></i>
          <p>Ad Free<br>No distractions on your quest</p>
        </div>
        <div class="feature">
          <i class="fas fa-moon"></i>
          <p>Dark Mode<br>Save your vision for the final boss</p>
        </div>
      </div>
    </div>

    <div id="signinForm" style="display: none;">
      <div class="title">CREATE YOUR <span>ACCOUNT</span></div>
      <div class="subtitle">Sign in to track your progress</div>
      <input type="text" id="username" placeholder="Hero Name" required />
      <input type="password" id="password" placeholder="Secret Code" required />
      <button data-action="sign-in">ENTER REALM</button>
      <p>New adventurer? <button data-action="create-account">CREATE ACCOUNT</button></p>
    </div>

    <div id="inputForm" style="display: none;">
      <div id="achievementLevel"></div>
      <div id="streakDisplay"></div>
      <button id="todoBtn">TO-DO</button>
      <button id="statsBtn">HERO STATS</button>
      <button id="pyqBtn">TRAINING GROUNDS</button>

      <div id="todoList">
        <h3>TO-DO</h3>
        <div id="tasks">
          <div class="task-line">
            <label class="neon-checkbox">
              <input type="checkbox" class="task-check" />
              <div class="neon-checkbox__frame">
                <div class="neon-checkbox__box">
                  <div class="neon-checkbox__check-container">
                    <svg viewBox="0 0 24 24" class="neon-checkbox__check">
                      <path d="M3,12.5l7,7L21,5"></path>
                    </svg>
                  </div>
                  <div class="neon-checkbox__glow"></div>
                  <div class="neon-checkbox__borders">
                    <span></span><span></span><span></span><span></span>
                  </div>
                </div>
                <div class="neon-checkbox__effects">
                  <div class="neon-checkbox__particles">
                    <span></span><span></span><span></span><span></span>
                    <span></span><span></span><span></span><span></span>
                    <span></span><span></span><span></span><span></span>
                  </div>
                  <div class="neon-checkbox__rings">
                    <div class="ring"></div>
                    <div class="ring"></div>
                    <div class="ring"></div>
                  </div>
                  <div class="neon-checkbox__sparks">
                    <span></span><span></span><span></span><span></span>
                  </div>
                </div>
              </div>
            </label>
            <input type="text" class="task-text" placeholder="Add a quest..." />
            <button class="set-deadline">‚è∞</button>
            <span class="remove-task">x</span>
          </div>
        </div>
        <button data-action="save-tasks">SAVE QUESTS</button>
      </div>

      <div id="analytics">
        <h3>HERO STATS</h3>
        <p>Focus Time: <span id="totalFocusTime">0</span> min</p>
        <p>Distractions Defeated: <span id="totalDistractions">0</span></p>
        <p>Videos Completed: <span id="totalVideosWatched">0</span></p>
      </div>

      <div class="title">ENTER YOUR <span>YOUTUBE URL</span></div>
      <div class="subtitle"></div>
      <select id="playlistSelect">
        <option value="">Select a Playlist</option>
      </select>
      <input type="text" id="playlistName" placeholder="Save Path As..." />
      <button data-action="save-playlist">SAVE PLAYLIST</button>
      <button data-action="remove-playlist">DELETE PLAYLIST</button>

      <div id="urlInputs">
        <div class="url-container">
          <input type="text" class="youtube-url" placeholder="YouTube URL (Videos or Live Streams)" required />
        </div>
      </div>

      <button data-action="add-url">ADD URL</button>
      <button data-action="start-playback">BEGIN FOCUS</button>
    </div>

    <div id="player" style="display: none;"></div>

    <div id="timerDisplay">
      <span id="timerText"></span>
      <div id="progressBar">
        <div id="progressFill"></div>
      </div>
    </div>

    <div id="pointsDisplay"><span style="color: #8e2de2;">‚≠ê</span> XP: 0</div>
    <div id="clockDisplay"></div>

    <div id="sitesBox" style="display: none;">ALLIED REALMS üëá</div>
    <div id="sitesPopup">
      <button id="closeSitesPopup">X</button>
      <a href="https://forestquest.vercel.app/" target="_blank" rel="noreferrer">FOREST QUEST - TASK MANAGEMENT</a>
      <a href="https://focuswithpomodoro.netlify.app/" target="_blank" rel="noreferrer">POMODORO REALM</a>
      <a href="https://the-chosen-one-o5.github.io/Daily-Schedule/" target="_blank" rel="noreferrer">DAILY QUEST PLANNER</a>
    </div>

    <button id="restartBtn" style="display: none;">EXIT</button>

    <div id="videoSidebar"></div>

    <div id="achievementOverlay"></div>

    <div id="confirmationDialog" style="display: none;">
      <p>Are you sure you want to abandon your quest?</p>
      <button id="confirmBtn">YES</button>
      <button id="cancelBtn">NO</button>
    </div>

    <div id="streakShieldDialog" style="display: none;">
      <p>Are you sure you want to buy Streak Shield for 800 XP? (Protects streak for 1 week)</p>
      <button id="streakShieldConfirmBtn">YES</button>
      <button id="streakShieldCancelBtn">NO</button>
    </div>

    <div id="doublePointsDialog" style="display: none;">
      <p>Are you sure you want to buy Double Points Power-Up for 800 XP? (Doubles points for 24 hours)</p>
      <button id="doublePointsConfirmBtn">YES</button>
      <button id="doublePointsCancelBtn">NO</button>
    </div>

    <div id="deadlineDialog" style="display: none;">
      <h3>Set Task Deadline</h3>
      <p>Set a deadline for your task to earn points!</p>
      <input type="date" id="deadlineDate" />
      <input type="time" id="deadlineTime" />
      <select id="taskDifficulty">
        <option value="50">Easy (50 points)</option>
        <option value="100">Medium (100 points)</option>
        <option value="200">Hard (200 points)</option>
        <option value="300">Very Hard (300 points)</option>
      </select>
      <button id="deadlineConfirmBtn">SET DEADLINE</button>
      <button id="deadlineCancelBtn">CANCEL</button>
    </div>

    <div id="sessionCompleteDialog" style="display: none;">
      <h3>Session Complete!</h3>
      <p>Great work! You've completed a focus session.</p>
      <p>One more session for +100 bonus points?</p>
      <button id="sessionContinueBtn">CONTINUE (+100 XP)</button>
      <button id="sessionEndBtn">END SESSION</button>
    </div>

    <button id="pdfToggle">PDF UPLOAD</button>

    <div id="pdfViewer">
      <input type="file" id="pdfInput" accept=".pdf" />
      <iframe id="pdfFrame"></iframe>
      <button onclick="togglePDFViewer()" style="background: #ff4444; margin-top: 10px;">CLOSE</button>
    </div>

    <div id="fireBox">üßô</div>
    <div id="aiPopup">
      <iframe src="https://www.chatbase.co/chatbot-iframe/3dSdpryiYZlWipHUL8dNK" frameBorder="0"></iframe>
    </div>

    <div id="mysteryBoxPopup" style="display: none;">
      <h3>Focus Mystery Box</h3>
      <p id="mysteryRewardText">Click to reveal your reward!</p>
      <button id="openMysteryBox">OPEN</button>
    </div>

    <div id="audioTracksStore" style="display: none;">
      <h3>AUDIO TRACKS STORE</h3>
      <p>Unlock exclusive Lo-Fi tracks to enhance your focus sessions!</p>
      <div id="audioTracksList"></div>
      <button id="closeAudioStore" style="background: #ff4444; margin-top: 15px;">CLOSE</button>
    </div>

    <div id="pomodoroOverlay" style="display: none;">
      <div id="pomodoroContainer">
        <h3>QUIET POMODORO</h3>
        <p>Focus in silence, earn points with each minute</p>
        <div id="pomodoroTimer">60:00</div>
        <div id="pomodoroStatus">Ready to begin</div>
        <div id="pomodoroControls">
          <button id="pomodoroStartBtn">START</button>
          <button id="pomodoroPauseBtn">PAUSE</button>
          <button id="pomodoroResetBtn">RESET</button>
          <button id="pomodoroCloseBtn" style="background: #ff4444;">CLOSE</button>
        </div>
      </div>
    </div>

    <div id="lofiPlayer" style="display: none;">
      <div class="lofi-player">
        <div class="title-box">
          <p class="title-1"></p>
          <p class="title-2"></p>
        </div>
        <div class="controls">
          <button id="lofiPrev">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="11 4 4 12 11 20"></polyline>
              <line x1="20" y1="12" x2="4" y2="12"></line>
            </svg>
          </button>
          <button id="lofiPause">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M12 21.6a9.6 9.6 0 1 0 0-19.2 9.6 9.6 0 0 0 0 19.2ZM9.6 7.2a1.2 1.2 0 0 1 1.2 1.2v7.2a1.2 1.2 0 0 1-2.4 0V8.4a1.2 1.2 0 0 1 1.2-1.2Zm4.8 0a1.2 1.2 0 0 1 1.2 1.2v7.2a1.2 1.2 0 0 1-2.4 0V8.4a1.2 1.2 0 0 1 1.2-1.2Z" clip-rule="evenodd"></path>
            </svg>
          </button>
          <button id="lofiNext">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="13 4 20 12 13 20"></polyline>
              <line x1="4" y1="12" x2="20" y2="12"></line>
            </svg>
          </button>
          <button id="volumeButton">
            üîä
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let timerInterval;
    let focusTime = 0;
    let points = 0;
    let distractions = 0;
    let videosWatched = 0;
    let currentVideoIndex = 0;
    let videoIds = [];
    let isDragging = false;
    let offsetX, offsetY;
    let playlists = JSON.parse(localStorage.getItem('playlists')) || {};
    let streak = parseInt(localStorage.getItem('streak')) || 0;
    let lastDate = localStorage.getItem('lastDate');
    let level = localStorage.getItem('level') || 'Mortal';
    let totalXP = parseInt(localStorage.getItem('totalXP')) || 0;
    let streakShieldActive = localStorage.getItem('streakShieldActive') === 'true';
    let doublePointsActive = localStorage.getItem('doublePointsActive') === 'true';
    let doublePointsEndTime = localStorage.getItem('doublePointsEndTime');
    let pomodoroInterval;
    let pomodoroTime = 60 * 60; // 60 minutes in seconds
    let pomodoroRunning = false;
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let currentTaskIndex = null;
    let audioPlayer = new Audio();
    let currentTrackIndex = 0;
    let audioTracks = [
      { name: 'Lo-Fi Chill', src: 'https://www.youtube.com/watch?v=5qap5aO4i9A', cost: 0, unlocked: true },
      { name: 'Cyberpunk Vibes', src: 'https://www.youtube.com/watch?v=8GW6sLrK40k', cost: 500, unlocked: false },
      { name: 'Forest Ambience', src: 'https://www.youtube.com/watch?v=3mJ8GOq3evs', cost: 500, unlocked: false }
    ];

    const today = new Date().toDateString();
    if (lastDate !== today) {
      if (!streakShieldActive && lastDate && new Date(lastDate).getDate() !== new Date(today).getDate() - 1) {
        streak = 0;
      }
      localStorage.setItem('lastDate', today);
      localStorage.setItem('streak', streak);
    }

    if (doublePointsEndTime && new Date().getTime() > doublePointsEndTime) {
      doublePointsActive = false;
      localStorage.setItem('doublePointsActive', 'false');
      localStorage.removeItem('doublePointsEndTime');
    }

    document.querySelectorAll('button[data-action]').forEach(button => {
      button.addEventListener('click', handleButtonClick);
    });

    function handleButtonClick(e) {
      const action = e.target.getAttribute('data-action');
      switch (action) {
        case 'start-game':
          document.getElementById('landingPage').style.display = 'none';
          document.getElementById('signinForm').style.display = 'block';
          break;
        case 'github':
          window.open('https://github.com/The-Chosen-One-o5/Focus-Mode-YouTube-Player', '_blank');
          break;
        case 'sign-in':
          signIn();
          break;
        case 'create-account':
          document.getElementById('signinForm').querySelector('.subtitle').textContent = 'Create your adventurer profile';
          signIn(true);
          break;
        case 'add-url':
          addUrlInput();
          break;
        case 'start-playback':
          startPlayback();
          break;
        case 'save-playlist':
          savePlaylist();
          break;
        case 'remove-playlist':
          removePlaylist();
          break;
        case 'save-tasks':
          saveTasks();
          break;
      }
    }

    function signIn(isNew = false) {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      if (username && password) {
        if (isNew) {
          localStorage.setItem('username', username);
          localStorage.setItem('password', password);
          alert('Account created! Welcome, ' + username + '!');
        } else {
          const storedUsername = localStorage.getItem('username');
          const storedPassword = localStorage.getItem('password');
          if (storedUsername === username && storedPassword === password) {
            alert('Welcome back, ' + username + '!');
          } else {
            alert('Invalid credentials!');
            return;
          }
        }
        document.getElementById('sidebarUsername').textContent = username;
        document.getElementById('signinForm').style.display = 'none';
        document.getElementById('inputForm').style.display = 'block';
        loadPlaylists();
        updateLevelDisplay();
        updateStreakDisplay();
        loadTasks();
      } else {
        alert('Please enter both a username and password!');
      }
    }

    function addUrlInput() {
      const urlInputs = document.getElementById('urlInputs');
      const newInput = document.createElement('div');
      newInput.className = 'url-container';
      newInput.innerHTML = `
        <input type="text" class="youtube-url" placeholder="YouTube URL (Videos or Live Streams)" required />
        <button onclick="this.parentElement.remove()">REMOVE</button>
      `;
      urlInputs.appendChild(newInput);
    }

    function startPlayback() {
      const urls = Array.from(document.getElementsByClassName('youtube-url')).map(input => input.value).filter(url => url);
      if (urls.length === 0) {
        alert('Please enter at least one YouTube URL!');
        return;
      }
      videoIds = urls.map(url => extractVideoId(url));
      document.getElementById('inputForm').style.display = 'none';
      document.getElementById('player').style.display = 'block';
      document.getElementById('timerDisplay').style.display = 'block';
      document.getElementById('pointsDisplay').style.display = 'block';
      document.getElementById('clockDisplay').style.display = 'block';
      document.getElementById('restartBtn').style.display = 'block';
      document.getElementById('sitesBox').style.display = 'block';
      document.getElementById('pdfToggle').style.display = 'block';
      document.getElementById('lofiPlayer').style.display = 'block';
      playAudioTrack(); // Start playing the first unlocked track
      loadVideoSidebar();
      initializePlayer();
      startTimer();
      startClock();
    }

    function extractVideoId(url) {
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : url;
    }

    function initializePlayer() {
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: videoIds[currentVideoIndex],
        playerVars: {
          'autoplay': 1,
          'controls': 1,
          'rel': 0,
          'fs': 1,
          'modestbranding': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      event.target.playVideo();
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        videosWatched++;
        currentVideoIndex++;
        if (currentVideoIndex < videoIds.length) {
          player.loadVideoById(videoIds[currentVideoIndex]);
        } else {
          endSession();
        }
      }
    }

    function startTimer() {
      let timeLeft = 25 * 60; // 25 minutes default
      const progressFill = document.getElementById('progressFill');
      document.getElementById('progressBar').style.display = 'block';
      timerInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('timerText').textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
        focusTime++;
        points += doublePointsActive ? 2 : 1;
        totalXP += doublePointsActive ? 2 : 1;
        localStorage.setItem('totalXP', totalXP);
        updatePointsDisplay();
        updateLevel();
        const progress = ((25 * 60 - timeLeft) / (25 * 60)) * 100;
        progressFill.style.width = `${progress}%`;
        timeLeft--;
        if (timeLeft < 0) {
          clearInterval(timerInterval);
          showSessionCompleteDialog();
        }
      }, 1000);
    }

    function updatePointsDisplay() {
      document.getElementById('pointsDisplay').innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`;
      document.getElementById('sidebarXP').textContent = totalXP;
    }

    function updateLevel() {
      const levels = [
        { name: 'Mortal', threshold: 0 },
        { name: 'Apprentice', threshold: 1000 },
        { name: 'Warrior', threshold: 2500 },
        { name: 'Master', threshold: 5000 },
        { name: 'Legend', threshold: 10000 }
      ];
      for (let i = levels.length - 1; i >= 0; i--) {
        if (totalXP >= levels[i].threshold) {
          if (level !== levels[i].name) {
            level = levels[i].name;
            localStorage.setItem('level', level);
            showAchievement(`Leveled up to ${level}!`);
          }
          break;
        }
      }
      updateLevelDisplay();
    }

    function updateLevelDisplay() {
      document.getElementById('achievementLevel').textContent = `Level: ${level}`;
      document.getElementById('sidebarLevel').textContent = level;
    }

    function updateStreakDisplay() {
      document.getElementById('streakDisplay').textContent = `Streak: ${streak} days`;
      document.getElementById('sidebarStreak').textContent = `${streak} days`;
    }

    function showAchievement(message) {
      const overlay = document.getElementById('achievementOverlay');
      overlay.textContent = message;
      overlay.classList.add('glow', 'rainbow');
      overlay.style.display = 'flex';
      setTimeout(() => {
        overlay.style.display = 'none';
        overlay.classList.remove('glow', 'rainbow');
      }, 3000);
    }

    function startClock() {
      setInterval(() => {
        const now = new Date();
        const hours = now.getHours() % 12 || 12;
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const period = now.getHours() >= 12 ? 'PM' : 'AM';
        document.getElementById('clockDisplay').innerHTML = `<span class="time">${hours}:${minutes}:${seconds}</span> <span class="period">${period}</span>`;
      }, 1000);
    }

    document.getElementById('timerDisplay').addEventListener('mousedown', (e) => {
      isDragging = true;
      offsetX = e.clientX - document.getElementById('timerDisplay').offsetLeft;
      offsetY = e.clientY - document.getElementById('timerDisplay').offsetTop;
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        document.getElementById('timerDisplay').style.left = `${e.clientX - offsetX}px`;
        document.getElementById('timerDisplay').style.top = `${e.clientY - offsetY}px`;
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
    });

    document.getElementById('sitesBox').addEventListener('click', () => {
      document.getElementById('sitesPopup').style.display = 'block';
    });

    document.getElementById('closeSitesPopup').addEventListener('click', () => {
      document.getElementById('sitesPopup').style.display = 'none';
    });

    document.getElementById('restartBtn').addEventListener('click', () => {
      document.getElementById('confirmationDialog').style.display = 'block';
    });

    document.getElementById('confirmBtn').addEventListener('click', () => {
      endSession();
      document.getElementById('confirmationDialog').style.display = 'none';
    });

    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('confirmationDialog').style.display = 'none';
    });

    function endSession() {
      clearInterval(timerInterval);
      player.stopVideo();
      document.getElementById('player').style.display = 'none';
      document.getElementById('timerDisplay').style.display = 'none';
      document.getElementById('pointsDisplay').style.display = 'none';
      document.getElementById('clockDisplay').style.display = 'none';
      document.getElementById('restartBtn').style.display = 'none';
      document.getElementById('sitesBox').style.display = 'none';
      document.getElementById('videoSidebar').style.right = '-320px';
      document.getElementById('pdfToggle').style.display = 'none';
      document.getElementById('lofiPlayer').style.display = 'none';
      audioPlayer.pause();
      document.getElementById('inputForm').style.display = 'block';
      updateStats();
      if (focusTime >= 25 * 60) {
        streak++;
        localStorage.setItem('streak', streak);
        updateStreakDisplay();
        checkMysteryBox();
      }
    }

    function updateStats() {
      document.getElementById('totalFocusTime').textContent = Math.floor(focusTime / 60);
      document.getElementById('totalDistractions').textContent = distractions;
      document.getElementById('totalVideosWatched').textContent = videosWatched;
    }

    function loadVideoSidebar() {
      const sidebar = document.getElementById('videoSidebar');
      sidebar.innerHTML = '<button id="minimizeBtn">X</button>';
      videoIds.forEach((id, index) => {
        const img = document.createElement('img');
        img.src = `https://img.youtube.com/vi/${id}/mqdefault.jpg`;
        img.className = 'thumbnail';
        img.alt = `Video ${index + 1}`;
        img.addEventListener('click', () => {
          currentVideoIndex = index;
          player.loadVideoById(videoIds[currentVideoIndex]);
        });
        sidebar.appendChild(img);
      });
      sidebar.style.right = '0';
      document.getElementById('minimizeBtn').addEventListener('click', () => {
        sidebar.style.right = '-320px';
      });
    }

    document.getElementById('statsBtn').addEventListener('click', () => {
      const analytics = document.getElementById('analytics');
      analytics.style.display = analytics.style.display === 'block' ? 'none' : 'block';
      updateStats();
    });

    document.getElementById('todoBtn').addEventListener('click', () => {
      const todoList = document.getElementById('todoList');
      todoList.classList.toggle('expanded');
      todoList.style.display = todoList.style.display === 'block' ? 'none' : 'block';
    });

    document.addEventListener('click', (e) => {
      const todoList = document.getElementById('todoList');
      const todoBtn = document.getElementById('todoBtn');
      if (todoList.classList.contains('expanded') && !todoList.contains(e.target) && e.target !== todoBtn) {
        todoList.classList.remove('expanded');
        todoList.style.display = 'none';
      }
    });

    document.getElementById('pyqBtn').addEventListener('click', () => {
      window.open('https://the-chosen-one-o5.github.io/PYQs-for-DSA/', '_blank');
    });

    function loadTasks() {
      const tasksDiv = document.getElementById('tasks');
      tasksDiv.innerHTML = '';
      tasks.forEach((task, index) => {
        addTaskElement(task.text, task.completed, task.deadline, task.points, index);
      });
      if (tasks.length === 0) {
        addTaskElement();
      }
    }

    function addTaskElement(text = '', completed = false, deadline = null, points = 0, index = tasks.length) {
      const tasksDiv = document.getElementById('tasks');
      const taskLine = document.createElement('div');
      taskLine.className = 'task-line';
      taskLine.innerHTML = `
        <label class="neon-checkbox">
          <input type="checkbox" class="task-check" ${completed ? 'checked' : ''} />
          <div class="neon-checkbox__frame">
            <div class="neon-checkbox__box">
              <div class="neon-checkbox__check-container">
                <svg viewBox="0 0 24 24" class="neon-checkbox__check">
                  <path d="M3,12.5l7,7L21,5"></path>
                </svg>
              </div>
              <div class="neon-checkbox__glow"></div>
              <div class="neon-checkbox__borders">
                <span></span><span></span><span></span><span></span>
              </div>
            </div>
            <div class="neon-checkbox__effects">
              <div class="neon-checkbox__particles">
                <span></span><span></span><span></span><span></span>
                <span></span><span></span><span></span><span></span>
                <span></span><span></span><span></span><span></span>
              </div>
              <div class="neon-checkbox__rings">
                <div class="ring"></div>
                <div class="ring"></div>
                <div class="ring"></div>
              </div>
              <div class="neon-checkbox__sparks">
                <span></span><span></span><span></span><span></span>
              </div>
            </div>
          </div>
        </label>
        <input type="text" class="task-text" value="${text}" placeholder="Add a quest..." />
        <button class="set-deadline">‚è∞</button>
        <span class="remove-task">x</span>
        ${deadline ? `<span class="deadline-info">Due: ${new Date(deadline).toLocaleString()}</span>` : ''}
        ${points ? `<span class="points-info">+${points} XP</span>` : ''}
      `;
      tasksDiv.appendChild(taskLine);

      const checkbox = taskLine.querySelector('.task-check');
      checkbox.addEventListener('change', () => {
        tasks[index].completed = checkbox.checked;
        if (checkbox.checked && tasks[index].deadline && new Date() <= new Date(tasks[index].deadline)) {
          points += tasks[index].points;
          totalXP += tasks[index].points;
          localStorage.setItem('totalXP', totalXP);
          updatePointsDisplay();
          updateLevel();
          showAchievement(`Task Completed! +${tasks[index].points} XP`);
        }
        saveTasks();
      });

      const removeBtn = taskLine.querySelector('.remove-task');
      removeBtn.addEventListener('click', () => {
        tasks.splice(index, 1);
        loadTasks();
        saveTasks();
      });

      const deadlineBtn = taskLine.querySelector('.set-deadline');
      deadlineBtn.addEventListener('click', () => {
        currentTaskIndex = index;
        document.getElementById('deadlineDialog').style.display = 'block';
      });
    }

    function saveTasks() {
      const taskInputs = document.querySelectorAll('.task-text');
      const checkboxes = document.querySelectorAll('.task-check');
      tasks = Array.from(taskInputs).map((input, i) => ({
        text: input.value,
        completed: checkboxes[i].checked,
        deadline: tasks[i] ? tasks[i].deadline : null,
        points: tasks[i] ? tasks[i].points : 0
      })).filter(task => task.text);
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    document.getElementById('deadlineConfirmBtn').addEventListener('click', () => {
      const date = document.getElementById('deadlineDate').value;
      const time = document.getElementById('deadlineTime').value;
      const points = parseInt(document.getElementById('taskDifficulty').value);
      if (date && time && currentTaskIndex !== null) {
        const deadline = new Date(`${date}T${time}`).toISOString();
        tasks[currentTaskIndex].deadline = deadline;
        tasks[currentTaskIndex].points = points;
        loadTasks();
        saveTasks();
      }
      document.getElementById('deadlineDialog').style.display = 'none';
    });

    document.getElementById('deadlineCancelBtn').addEventListener('click', () => {
      document.getElementById('deadlineDialog').style.display = 'none';
    });

    function loadPlaylists() {
      const select = document.getElementById('playlistSelect');
      select.innerHTML = '<option value="">Select a Playlist</option>';
      Object.keys(playlists).forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });
      select.addEventListener('change', () => {
        const selected = select.value;
        if (selected) {
          const urls = playlists[selected];
          const urlInputs = document.getElementById('urlInputs');
          urlInputs.innerHTML = '';
          urls.forEach(url => {
            const div = document.createElement('div');
            div.className = 'url-container';
            div.innerHTML = `
              <input type="text" class="youtube-url" value="${url}" required />
              <button onclick="this.parentElement.remove()">REMOVE</button>
            `;
            urlInputs.appendChild(div);
          });
        }
      });
    }

    function savePlaylist() {
      const name = document.getElementById('playlistName').value;
      const urls = Array.from(document.getElementsByClassName('youtube-url')).map(input => input.value).filter(url => url);
      if (name && urls.length > 0) {
        playlists[name] = urls;
        localStorage.setItem('playlists', JSON.stringify(playlists));
        loadPlaylists();
        document.getElementById('playlistName').value = '';
        alert('Playlist saved!');
      } else {
        alert('Please enter a name and at least one URL!');
      }
    }

    function removePlaylist() {
      const selected = document.getElementById('playlistSelect').value;
      if (selected && confirm(`Delete playlist "${selected}"?`)) {
        delete playlists[selected];
        localStorage.setItem('playlists', JSON.stringify(playlists));
        loadPlaylists();
        document.getElementById('urlInputs').innerHTML = `
          <div class="url-container">
            <input type="text" class="youtube-url" placeholder="YouTube URL (Videos or Live Streams)" required />
          </div>
        `;
      }
    }

    document.getElementById('pdfToggle').addEventListener('click', togglePDFViewer);

    function togglePDFViewer() {
      const pdfViewer = document.getElementById('pdfViewer');
      pdfViewer.style.display = pdfViewer.style.display === 'block' ? 'none' : 'block';
      if (pdfViewer.style.display === 'block') {
        document.getElementById('pdfInput').addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file && file.type === 'application/pdf') {
            const url = URL.createObjectURL(file);
            document.getElementById('pdfFrame').src = url;
          }
        }, { once: true });
      }
    }

    document.getElementById('fireBox').addEventListener('click', () => {
      const aiPopup = document.getElementById('aiPopup');
      aiPopup.style.display = aiPopup.style.display === 'block' ? 'none' : 'block';
    });

    function checkMysteryBox() {
      if (streak > 0 && streak % 3 === 0) {
        document.getElementById('mysteryBoxPopup').style.display = 'block';
      }
    }

    document.getElementById('openMysteryBox').addEventListener('click', () => {
      const rewards = [
        { type: 'points', value: 200, text: '200 XP' },
        { type: 'streakShield', value: 1, text: 'Streak Shield (1 week)' },
        { type: 'doublePoints', value: 1, text: 'Double Points (24 hours)' }
      ];
      const reward = rewards[Math.floor(Math.random() * rewards.length)];
      document.getElementById('mysteryRewardText').textContent = `You won ${reward.text}!`;
      document.getElementById('openMysteryBox').style.display = 'none';
      setTimeout(() => {
        document.getElementById('mysteryBoxPopup').style.display = 'none';
        document.getElementById('openMysteryBox').style.display = 'block';
        document.getElementById('mysteryRewardText').textContent = 'Click to reveal your reward!';
      }, 2000);

      if (reward.type === 'points') {
        points += reward.value;
        totalXP += reward.value;
        localStorage.setItem('totalXP', totalXP);
        updatePointsDisplay();
        updateLevel();
      } else if (reward.type === 'streakShield') {
        activateStreakShield();
      } else if (reward.type === 'doublePoints') {
        activateDoublePoints();
      }
    });

    document.getElementById('streakShieldBtn').addEventListener('click', () => {
      document.getElementById('streakShieldDialog').style.display = 'block';
    });

    document.getElementById('streakShieldConfirmBtn').addEventListener('click', () => {
      if (totalXP >= 800) {
        totalXP -= 800;
        localStorage.setItem('totalXP', totalXP);
        activateStreakShield();
        document.getElementById('streakShieldDialog').style.display = 'none';
        updatePointsDisplay();
        updateLevel();
      } else {
        alert('Not enough XP!');
      }
    });

    document.getElementById('streakShieldCancelBtn').addEventListener('click', () => {
      document.getElementById('streakShieldDialog').style.display = 'none';
    });

    function activateStreakShield() {
      streakShieldActive = true;
      localStorage.setItem('streakShieldActive', 'true');
      setTimeout(() => {
        streakShieldActive = false;
        localStorage.setItem('streakShieldActive', 'false');
      }, 7 * 24 * 60 * 60 * 1000); // 1 week
      showAchievement('Streak Shield Activated!');
    }

    document.getElementById('doublePointsBtn').addEventListener('click', () => {
      document.getElementById('doublePointsDialog').style.display = 'block';
    });

    document.getElementById('doublePointsConfirmBtn').addEventListener('click', () => {
      if (totalXP >= 800) {
        totalXP -= 800;
        localStorage.setItem('totalXP', totalXP);
        activateDoublePoints();
        document.getElementById('doublePointsDialog').style.display = 'none';
        updatePointsDisplay();
        updateLevel();
      } else {
        alert('Not enough XP!');
      }
    });

    document.getElementById('doublePointsCancelBtn').addEventListener('click', () => {
      document.getElementById('doublePointsDialog').style.display = 'none';
    });

    function activateDoublePoints() {
      doublePointsActive = true;
      const endTime = new Date().getTime() + 24 * 60 * 60 * 1000; // 24 hours
      localStorage.setItem('doublePointsActive', 'true');
      localStorage.setItem('doublePointsEndTime', endTime);
      setTimeout(() => {
        doublePointsActive = false;
        localStorage.setItem('doublePointsActive', 'false');
        localStorage.removeItem('doublePointsEndTime');
      }, 24 * 60 * 60 * 1000);
      showAchievement('Double Points Activated!');
    }

    document.getElementById('sessionContinueBtn').addEventListener('click', () => {
      document.getElementById('sessionCompleteDialog').style.display = 'none';
      points += 100;
      totalXP += 100;
      localStorage.setItem('totalXP', totalXP);
      updatePointsDisplay();
      updateLevel();
      startTimer();
    });

    document.getElementById('sessionEndBtn').addEventListener('click', () => {
      document.getElementById('sessionCompleteDialog').style.display = 'none';
      endSession();
    });

    function showSessionCompleteDialog() {
      document.getElementById('sessionCompleteDialog').style.display = 'block';
    }

    document.getElementById('audioStoreBtn').addEventListener('click', () => {
      loadAudioStore();
      document.getElementById('audioTracksStore').style.display = 'block';
    });

    document.getElementById('closeAudioStore').addEventListener('click', () => {
      document.getElementById('audioTracksStore').style.display = 'none';
    });

    function loadAudioStore() {
      const audioList = document.getElementById('audioTracksList');
      audioList.innerHTML = '';
      audioTracks.forEach((track, index) => {
        const savedTrack = JSON.parse(localStorage.getItem(`audioTrack_${index}`));
        if (savedTrack && savedTrack.unlocked) {
          track.unlocked = true;
        }
        const trackItem = document.createElement('div');
        trackItem.className = `audio-track-item ${track.unlocked ? 'unlocked' : 'locked'}`;
        trackItem.innerHTML = `
          <span class="track-name">${track.name} ${track.unlocked ? '' : `(${track.cost} XP)`}</span>
          <button class="unlock-track-btn" data-index="${index}" ${track.unlocked ? 'disabled' : ''}>
            ${track.unlocked ? 'UNLOCKED' : 'UNLOCK'}
          </button>
        `;
        audioList.appendChild(trackItem);
      });

      document.querySelectorAll('.unlock-tracker-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.getAttribute('data-index'));
          const track = audioTracks[index];
          if (!track.unlocked && totalXP >= track.cost) {
            totalXP -= track.cost;
            track.unlocked = true;
            localStorage.setItem(`audioTrack_${index}`, JSON.stringify(track));
            localStorage.setItem('totalXP', totalXP);
            updatePointsDisplay();
            updateLevel();
            btn.textContent = 'UNLOCKED';
            btn.disabled = true;
            trackItem.classList.remove('locked');
            trackItem.classList.add('unlocked');
            showAchievement(`${track.name} Unlocked!`);
            playAudioTrack();
          } else if (!track.unlocked) {
            alert('Not enough XP!');
          }
        });
      });
    }

    function playAudioTrack() {
      const unlockedTracks = audioTracks.filter(track => track.unlocked);
      if (unlockedTracks.length > 0) {
        const track = unlockedTracks[currentTrackIndex % unlockedTracks.length];
        audioPlayer.src = track.src;
        audioPlayer.play();
        updateLofiPlayer(track.name);
      }
    }

    function updateLofiPlayer(trackName) {
      document.querySelector('.title-1').textContent = trackName.split(' - ')[0] || trackName;
      document.querySelector('.title-2').textContent = trackName.split(' - ')[1] || 'Unknown Artist';
    }

    document.getElementById('lofiPrev').addEventListener('click', () => {
      const unlockedTracks = audioTracks.filter(track => track.unlocked);
      if (unlockedTracks.length > 0) {
        currentTrackIndex = (currentTrackIndex - 1 + unlockedTracks.length) % unlockedTracks.length;
        playAudioTrack();
      }
    });

    document.getElementById('lofiNext').addEventListener('click', () => {
      const unlockedTracks = audioTracks.filter(track => track.unlocked);
      if (unlockedTracks.length > 0) {
        currentTrackIndex = (currentTrackIndex + 1) % unlockedTracks.length;
        playAudioTrack();
      }
    });

    document.getElementById('lofiPause').addEventListener('click', () => {
      if (audioPlayer.paused) {
        audioPlayer.play();
        document.getElementById('lofiPause').innerHTML = `
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M21.6 12a9.6 9.6 0 1 1-19.2 0 9.6 9.6 0 0 1 19.2 0ZM8.4 9.6a1.2 1.2 0 1 1 2.4 0v4.8a1.2 1.2 0 1 1-2.4 0V9.6Zm6-1.2a1.2 1.2 0 0 0-1.2 1.2v4.8a1.2 1.2 0 1 0 2.4 0V9.6a1.2 1.2 0 0 0-1.2-1.2Z" clip-rule="evenodd"></path>
          </svg>
        `;
      } else {
        audioPlayer.pause();
        document.getElementById('lofiPause').innerHTML = `
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M12 21.6a9.6 9.6 0 1 0 0-19.2 9.6 9.6 0 0 0 0 19.2ZM9.6 7.2a1.2 1.2 0 0 1 1.2 1.2v7.2a1.2 1.2 0 0 1-2.4 0V8.4a1.2 1.2 0 0 1 1.2-1.2Zm4.8 0a1.2 1.2 0 0 1 1.2 1.2v7.2a1.2 1.2 0 0 1-2.4 0V8.4a1.2 1.2 0 0 1 1.2-1.2Z" clip-rule="evenodd"></path>
          </svg>
        `;
      }
    });

    document.getElementById('volumeButton').addEventListener('click', () => {
      audioPlayer.volume = audioPlayer.volume === 0 ? 1 : 0;
    });

    document.getElementById('quietPomodoroBtn').addEventListener('click', () => {
      document.getElementById('pomodoroOverlay').style.display = 'flex';
    });

    document.getElementById('pomodoroStartBtn').addEventListener('click', () => {
      if (!pomodoroRunning) {
        pomodoroRunning = true;
        pomodoroInterval = setInterval(() => {
          pomodoroTime--;
          const minutes = Math.floor(pomodoroTime / 60);
          const seconds = pomodoroTime % 60;
          document.getElementById('pomodoroTimer').textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
          points += doublePointsActive ? 2 : 1;
          totalXP += doublePointsActive ? 2 : 1;
          localStorage.setItem('totalXP', totalXP);
          updatePointsDisplay();
          updateLevel();
          document.getElementById('pomodoroStatus').textContent = 'Focusing...';
          if (pomodoroTime <= 0) {
            clearInterval(pomodoroInterval);
            pomodoroRunning = false;
            document.getElementById('pomodoroStatus').textContent = 'Session Complete!';
            showAchievement('Pomodoro Session Completed! +50 XP');
            points += 50;
            totalXP += 50;
            localStorage.setItem('totalXP', totalXP);
            updatePointsDisplay();
            updateLevel();
          }
        }, 1000);
      }
    });

    document.getElementById('pomodoroPauseBtn').addEventListener('click', () => {
      if (pomodoroRunning) {
        clearInterval(pomodoroInterval);
        pomodoroRunning = false;
        document.getElementById('pomodoroStatus').textContent = 'Paused';
      }
    });

    document.getElementById('pomodoroResetBtn').addEventListener('click', () => {
      clearInterval(pomodoroInterval);
      pomodoroRunning = false;
      pomodoroTime = 60 * 60;
      document.getElementById('pomodoroTimer').textContent = '60:00';
      document.getElementById('pomodoroStatus').textContent = 'Ready to begin';
    });

    document.getElementById('pomodoroCloseBtn').addEventListener('click', () => {
      clearInterval(pomodoroInterval);
      pomodoroRunning = false;
      pomodoroTime = 60 * 60;
      document.getElementById('pomodoroTimer').textContent = '60:00';
      document.getElementById('pomodoroStatus').textContent = 'Ready to begin';
      document.getElementById('pomodoroOverlay').style.display = 'none';
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('username');
        localStorage.removeItem('password');
        location.reload();
      }
    });

    audioPlayer.addEventListener('ended', () => {
      currentTrackIndex++;
      playAudioTrack();
    });

    window.addEventListener('beforeunload', (e) => {
      if (document.getElementById('player').style.display === 'block') {
        e.preventDefault();
        e.returnValue = 'Are you sure you want to leave? Your focus session will end.';
      }
    });
  </script>
</body>
</html>
