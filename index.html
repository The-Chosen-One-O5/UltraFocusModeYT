document.addEventListener('visibilitychange', () => {
    const focusAudio = document.getElementById('focusAudio');
    if (document.hidden && isFocusModeActive) {
        distractionCount++;
        totalDistractions++;
        if (isSignedIn) {
            points -= 10;
            document.getElementById('pointsDisplay').textContent = `Points: ${points}`;
            alert(`Stay focused! -10 points. Distractions: ${distractionCount}`);
        } else {
            alert(`Stay focused! Distractions: ${distractionCount}`);
        }
        focusAudio.loop = true;
        focusAudio.play().catch(error => {
            console.error('Error playing audio:', error);
        });
        // Pause background music during distraction alert
        if (musicPlayer && musicPlayer.pauseVideo) {
            musicPlayer.pauseVideo();
        }
        saveState();
    } else {
        focusAudio.pause();
        // Resume background music when tab is visible
        if (musicPlayer && musicPlayer.playVideo) {
            musicPlayer.playVideo();
        }
    }
});
