<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Mode YouTube Player</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #4169e1;
      --primary-dark: #1e3a8a;
      --secondary: #8e2de2;
      --accent: #ff4500;
      --accent-alt: #ff8c00;
      --bg-dark: #0f0f1b;
      --bg-medium: #1a1a2e;
      --bg-light: #252538;
      --text: #e0e0ff;
      --text-dim: #9090b0;
    }

    body {
      background-color: var(--bg-dark);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: monospace;
      color: var(--text);
      overflow: hidden;
      font-size: 18px;
      line-height: 1.4;
    }

    .game-container {
      width: 100%;
      height: 100vh;
      position: relative;
      overflow: hidden;
      background-image: radial-gradient(circle at 10% 20%, rgba(142, 45, 226, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(65, 105, 225, 0.1) 0%, transparent 20%),
        linear-gradient(to bottom, var(--bg-dark), var(--bg-medium));
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1;
    }

    .game-container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 5v1H5V0zm1 5v1H5v-1h1z'/%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 2;
    }

    #landingPage,
    #signinForm,
    #inputForm {
      text-align: center;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
      z-index: 10;
      background-color: rgba(15, 15, 27, 0.8);
      border: 2px solid var(--secondary);
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(142, 45, 226, 0.3);
      pointer-events: auto;
    }

    .title {
      font-family: monospace;
      font-size: 32px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      text-shadow: 3px 3px 0px var(--primary-dark);
      letter-spacing: 2px;
    }

    .title span {
      color: var(--secondary);
      position: relative;
      display: inline-block;
    }

    .title span::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
    }

    .subtitle {
      font-size: 20px;
      color: var(--text-dim);
      margin-bottom: 30px;
    }

    button {
      display: inline-block;
      padding: 12px 30px;
      font-size: 18px;
      font-family: monospace;
      font-weight: 600;
      background: var(--secondary);
      border: none;
      color: var(--text);
      border-radius: 0;
      cursor: pointer;
      margin: 0 10px 15px;
      transition: all 0.3s;
      position: relative;
      box-shadow: 4px 4px 0 var(--primary-dark);
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 1px;
      z-index: 11;
      pointer-events: auto;
    }

    button:hover {
      background: var(--primary);
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 var(--primary-dark);
    }

    button:active {
      transform: translate(4px, 4px);
      box-shadow: none;
    }

    .github-btn {
      background: var(--bg-light);
      box-shadow: 4px 4px 0 var(--bg-medium);
    }

    .github-btn:hover {
      background: var(--bg-medium);
      box-shadow: 2px 2px 0 var(--bg-medium);
    }

    #features {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 40px;
      flex-wrap: wrap;
      z-index: 10;
    }

    .feature {
      background: var(--bg-light);
      padding: 15px 20px;
      border-radius: 0;
      width: 200px;
      box-shadow: 4px 4px 0 var(--bg-medium);
      border: 2px solid var(--primary);
      position: relative;
      overflow: hidden;
      z-index: 10;
    }

    .feature::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    .feature i {
      font-size: 24px;
      color: var(--secondary);
      margin-bottom: 10px;
    }

    .feature p {
      font-size: 16px;
      color: var(--text);
    }

    input,
    select {
      display: block;
      width: 100%;
      max-width: 320px;
      margin: 10px auto;
      padding: 12px;
      border-radius: 0;
      font-size: 16px;
      font-family: monospace;
      background: var(--bg-light);
      border: 2px solid var(--primary);
      color: var(--text);
      outline: none;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.2);
      z-index: 11;
      pointer-events: auto;
    }

    input:focus,
    select:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 2px rgba(142, 45, 226, 0.3);
    }

    #inputForm {
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--secondary) var(--bg-medium);
    }

    #inputForm::-webkit-scrollbar {
      width: 8px;
    }

    #inputForm::-webkit-scrollbar-track {
      background: var(--bg-medium);
    }

    #inputForm::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 0;
      border: 2px solid var(--bg-medium);
    }

    #player {
      width: 100%;
      max-width: 1200px;
      aspect-ratio: 16 / 9;
      border-radius: 0;
      overflow: hidden;
      display: none;
      background: #000;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px rgba(65, 105, 225, 0.5);
      z-index: 5;
    }

    #timerDisplay {
      position: fixed;
      top: 10px;
      left: 10px;
      color: var(--text);
      font-size: 24px;
      z-index: 101;
      cursor: move;
      padding: 10px;
      background: var(--bg-medium);
      border: 2px solid var(--primary);
      font-family: monospace;
      font-size: 16px;
      pointer-events: auto;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    #timerDisplay button {
      pointer-events: auto;
      padding: 5px 10px;
      margin: 0 5px;
      font-size: 12px;
      z-index: 102;
    }

    #pointsDisplay {
      position: fixed;
      top: 50px;
      left: 10px;
      font-size: 18px;
      color: var(--text);
      font-family: monospace;
      font-weight: 600;
      z-index: 101;
      background: var(--bg-medium);
      padding: 8px 12px;
      border: 2px solid var(--secondary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: none;
    }

    #clockDisplay {
      position: fixed;
      top: 90px;
      left: 10px;
      font-size: 20px;
      font-family: monospace;
      font-weight: bold;
      z-index: 101;
      padding: 8px 12px;
      background: var(--bg-medium);
      border: 2px solid var(--primary);
      display: none;
      pointer-events: none;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    #clockDisplay .time {
      color: var(--primary);
    }

    #clockDisplay .period {
      color: var(--secondary);
    }

    #progressBar {
      width: 200px;
      height: 10px;
      background: var(--bg-light);
      display: none;
      margin-top: 5px;
      border: 2px solid var(--primary);
      z-index: 101;
    }

    #progressFill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    #sitesBox {
      display: none;
      position: fixed;
      top: 130px;
      left: 10px;
      z-index: 101;
      padding: 8px 12px;
      background: var(--bg-medium);
      border: 2px solid var(--primary);
      cursor: pointer;
      pointer-events: auto;
    }

    #sitesPopup {
      position: fixed;
      top: 170px;
      left: 10px;
      width: 250px;
      background: var(--bg-medium);
      padding: 15px;
      border: 2px solid var(--secondary);
      display: none;
      z-index: 102;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }

    #sitesPopup a {
      display: block;
      color: var(--primary);
      text-decoration: none;
      margin: 10px 0;
      font-size: 14px;
      font-family: monospace;
      padding: 5px;
      border: 1px solid var(--primary);
      transition: all 0.3s;
      pointer-events: auto;
    }

    #sitesPopup a:hover {
      color: var(--text);
      background: var(--primary);
      transform: translate(2px, 2px);
    }

    #closeSitesPopup {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--accent);
      border: none;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      padding: 2px 6px;
      margin: 0;
      z-index: 103;
    }

    #restartBtn {
      display: none;
      position: fixed;
      top: 10px;
      right: 10px;
      background: var(--accent);
      z-index: 103;
      pointer-events: auto;
    }

    #videoSidebar {
      position: fixed;
      right: -320px;
      top: 0;
      width: 300px;
      height: 100%;
      background: var(--bg-medium);
      transition: right 0.3s ease;
      padding: 20px;
      overflow-y: auto;
      z-index: 102;
      border-left: 4px solid var(--primary);
      pointer-events: auto;
    }

    .thumbnail {
      width: 100%;
      margin-bottom: 15px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 0;
      transition: all 0.3s;
      image-rendering: pixelated;
      pointer-events: auto;
    }

    .thumbnail:hover {
      border-color: var(--secondary);
      transform: scale(1.05);
    }

    #minimizeBtn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--accent);
      border: none;
      color: var(--text);
      cursor: pointer;
      font-size: 14px;
      padding: 2px 6px;
      margin: 0;
      box-shadow: none;
      z-index: 102;
    }

    .url-container {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .url-container button {
      margin-left: 10px;
      padding: 5px 10px;
      background: var(--accent);
      font-size: 14px;
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
      z-index: 11;
    }

    #statsBtn,
    #todoBtn,
    #pyqBtn {
      padding: 8px 16px;
      font-size: 12px;
      margin: 0 5px 15px;
      z-index: 11;
    }

    #analytics,
    #todoList {
      position: absolute;
      left: 10px;
      background: var(--bg-medium);
      padding: 15px;
      border: 2px solid var(--secondary);
      display: none;
      z-index: 100;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }

    #analytics {
      top: 90px;
    }

    #todoList {
      top: 50px;
      width: 300px;
      max-height: 400px;
    }

    #tasks {
      overflow-y: auto;
      max-height: 320px;
      margin-bottom: 10px;
      background: none;
    }

    #analytics h3,
    #todoList h3 {
      font-size: 20px;
      margin-bottom: 10px;
      color: var(--secondary);
      font-family: monospace;
      font-size: 16px;
      text-align: center;
    }

    #analytics p {
      font-size: 16px;
      margin: 5px 0;
      border-bottom: 1px solid var(--bg-light);
      padding-bottom: 5px;
    }

    .task-line {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      background: var(--bg-light);
      padding: 5px;
      border: 1px solid var(--primary);
      pointer-events: auto;
      position: relative;
    }

    .task-line input[type="checkbox"] {
      margin-right: 10px;
      width: 16px;
      height: 16px;
      appearance: none;
      border: 2px solid var(--primary);
      background: var(--bg-medium);
      position: relative;
      pointer-events: auto;
      z-index: 11;
    }

    .task-line input[type="checkbox"]:checked {
      background: var(--secondary);
    }

    .task-line input[type="checkbox"]:checked::after {
      content: "‚úì";
      position: absolute;
      color: var(--text);
      font-size: 12px;
      top: -2px;
      left: 2px;
    }

    .task-line input[type="text"] {
      flex-grow: 1;
      font-size: 16px;
      font-family: monospace;
      color: var(--text);
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--text-dim);
      padding: 2px 0;
      outline: none;
      box-shadow: none;
      margin: 0;
      pointer-events: auto;
      z-index: 11;
    }

    .task-line input[type="text"]:focus {
      border-bottom: 1px solid var(--secondary);
      box-shadow: none;
    }

    .task-line .remove-task {
      margin-left: 10px;
      color: var(--accent);
      font-size: 16px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      line-height: 1;
      pointer-events: auto;
      z-index: 11;
    }

    .task-line .set-deadline {
      margin-left: 10px;
      color: var(--primary);
      font-size: 14px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0 5px;
      pointer-events: auto;
      z-index: 11;
    }

    .deadline-popup {
      position: absolute;
      top: 100%;
      left: 0;
      width: 280px;
      background: var(--bg-medium);
      padding: 10px;
      border: 2px solid var(--primary);
      display: none;
      z-index: 12;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
    }

    .deadline-popup input[type="datetime-local"] {
      width: 100%;
      margin: 5px 0;
      font-size: 14px;
    }

    .deadline-popup input[type="number"] {
      width: 100%;
      margin: 5px 0;
      font-size: 14px;
    }

    .deadline-popup button {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      font-size: 12px;
    }

    #lofiPlayer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      z-index: 101;
      display: none;
      background: var(--bg-medium);
      padding: 10px;
      border: 2px solid var(--primary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: auto;
    }

    #lofiPlayer button {
      background: var(--secondary);
      border: none;
      color: var(--text);
      padding: 5px 10px;
      margin: 0 2px;
      cursor: pointer;
      font-size: 12px;
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
      font-family: monospace;
      z-index: 102;
    }

    #achievementOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      color: gold;
      font-size: 32px;
      font-weight: bold;
      z-index: 104;
      display: none;
      font-family: monospace;
      text-align: center;
      text-shadow: 3px 3px 0 var(--primary-dark);
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
    }

    #achievementLevel {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 20px;
      font-weight: bold;
      z-index: 101;
      font-family: monospace;
      background: var(--bg-medium);
      padding: 8px 12px;
      border: 2px solid var(--secondary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: none;
    }

    #streakDisplay {
      position: fixed;
      top: 60px;
      right: 10px;
      font-size: 16px;
      color: var(--text);
      z-index: 101;
      background: var(--bg-medium);
      padding: 8px 12px;
      border: 2px solid var(--secondary);
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      pointer-events: none;
      font-family: monospace;
    }

    .glow {
      text-shadow: 0 0 10px var(--text);
      animation: pulse 2s infinite;
    }

    .box-glow {
      border: 2px solid gold;
      padding: 5px;
      box-shadow: 0 0 10px gold;
      animation: pulse 2s infinite;
    }

    .rainbow {
      background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbow 3s infinite;
    }

    @keyframes rainbow {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    #confirmationDialog,
    #streakShieldDialog,
    #doublePointsDialog {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-medium);
      padding: 20px;
      border: 4px solid var(--accent);
      box-shadow: 0 0 20px rgba(255, 69, 0, 0.5);
      z-index: 105;
      display: none;
      text-align: center;
      pointer-events: auto;
      font-family: monospace;
    }

    #confirmationDialog p,
    #streakShieldDialog p,
    #doublePointsDialog p {
      font-size: 16px;
      margin-bottom: 20px;
    }

    #confirmationDialog button,
    #streakShieldDialog button,
    #doublePointsDialog button {
      padding: 8px 20px;
      margin: 0 10px;
      font-size: 14px;
      pointer-events: auto;
      z-index: 106;
    }

    #confirmBtn,
    #streakShieldConfirmBtn,
    #doublePointsConfirmBtn {
      background: var(--accent);
    }

    #cancelBtn,
    #streakShieldCancelBtn,
    #doublePointsCancelBtn {
      background: var(--primary);
    }

    #pdfToggle {
      display: none;
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: var(--primary);
      z-index: 101;
      cursor: pointer;
      pointer-events: auto;
    }

    #pdfViewer {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      height: 500px;
      background: var(--bg-medium);
      padding: 15px;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px rgba(65, 105, 225, 0.5);
      z-index: 101;
      pointer-events: auto;
    }

    #pdfInput {
      margin-bottom: 10px;
      width: 100%;
      pointer-events: auto;
      z-index: 102;
    }

    #pdfFrame {
      width: 100%;
      height: 90%;
      border: none;
      background: #fff;
    }

    #fireBox {
      position: fixed;
      bottom: 10px;
      left: 10px;
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      cursor: pointer;
      z-index: 100;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      border: 2px solid var(--secondary);
      pointer-events: auto;
    }

    #fireBox:hover {
      background: var(--secondary);
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
    }

    #aiPopup {
      position: fixed;
      bottom: 60px;
      left: 10px;
      width: 300px;
      height: 400px;
      background: var(--bg-medium);
      border-radius: 0;
      padding: 5px;
      display: none;
      z-index: 101;
      box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.3);
      border: 4px solid var(--primary);
      pointer-events: auto;
    }

    #aiPopup iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .game-sidebar {
      position: fixed;
      left: -250px;
      top: 0;
      width: 250px;
      height: 100vh;
      background: var(--bg-medium);
      border-right: 4px solid var(--primary);
      z-index: 200;
      transition: left 0.3s ease;
      padding: 20px 0;
      box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3);
      overflow-y: auto;
      pointer-events: auto;
    }

    .sidebar-trigger:hover + .game-sidebar,
    .game-sidebar:hover {
      left: 0;
    }

    .sidebar-trigger {
      position: fixed;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 80px;
      background: var(--primary);
      z-index: 199;
      border-radius: 0 5px 5px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      font-weight: bold;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      font-size: 12px;
      letter-spacing: 1px;
      pointer-events: auto;
    }

    .sidebar-section {
      padding: 15px;
      border-bottom: 2px solid var(--bg-dark);
    }

    .sidebar-section h3 {
      color: var(--secondary);
      font-size: 16px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .sidebar-section a,
    .sidebar-section button {
      display: block;
      width: 100%;
      padding: 8px 10px;
      margin: 5px 0;
      background: var(--bg-light);
      color: var(--text);
      border: 1px solid var(--primary);
      text-align: left;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      pointer-events: auto;
      z-index: 201;
    }

    .sidebar-section a:hover,
    .sidebar-section button:hover {
      background: var(--primary);
      transform: translateX(5px);
    }

    .dashboard-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .dashboard-info p {
      font-size: 14px;
      display: flex;
      justify-content: space-between;
    }

    .dashboard-info p span:first-child {
      font-weight: bold;
      color: var(--primary);
    }

    #mysteryBoxPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-medium);
      padding: 20px;
      border: 4px solid gold;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      z-index: 105;
      display: none;
      text-align: center;
      pointer-events: auto;
      font-family: monospace;
      width: 300px;
    }

    #mysteryBoxPopup h3 {
      color: gold;
      font-size: 20px;
      margin-bottom: 15px;
    }

    #mysteryBoxPopup p {
      font-size: 16px;
      margin-bottom: 20px;
    }

    #mysteryBoxPopup button {
      padding: 8px 20px;
      background: var(--accent);
      font-size: 14px;
      pointer-events: auto;
    }

    @media (max-width: 800px) {
      .title { font-size: 24px; }
      button { padding: 8px 16px; font-size: 12px; margin: 0 5px 10px; }
      #features { flex-direction: column; align-items: center; }
      .feature { width: 90%; max-width: 250px; }
      #timerDisplay, #pointsDisplay, #clockDisplay, #sitesBox { font-size: 14px; padding: 5px 8px; }
      #achievementLevel, #streakDisplay { font-size: 14px; padding: 5px 8px; }
      #videoSidebar { width: 250px; }
      #lofiPlayer button { padding: 3px 6px; font-size: 10px; }
      #confirmationDialog, #streakShieldDialog, #doublePointsDialog { width: 90%; max-width: 300px; }
      #confirmationDialog p, #streakShieldDialog p, #doublePointsDialog p { font-size: 14px; }
      #pdfViewer { width: 90%; height: 80%; max-height: 500px; }
      #aiPopup { width: 90%; max-width: 300px; height: 350px; }
      #mysteryBoxPopup { width: 90%; max-width: 280px; }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="sidebar-trigger">MENU</div>
    <div class="game-sidebar">
      <div class="sidebar-section">
        <h3>Dashboard</h3>
        <div class="dashboard-info">
          <p><span>Hero:</span> <span id="sidebarUsername">Guest</span></p>
          <p><span>Level:</span> <span id="sidebarLevel">Mortal</span></p>
          <p><span>XP:</span> <span id="sidebarXP">0</span></p>
          <p><span>Streak:</span> <span id="sidebarStreak">0 days</span></p>
        </div>
      </div>
      <div class="sidebar-section">
        <h3>Allied Realms</h3>
        <a href="https://forestquest.vercel.app/" target="_blank" rel="noreferrer">FOREST QUEST - TASK MANAGEMENT</a>
        <a href="https://focuswithpomodoro.netlify.app/" target="_blank" rel="noreferrer">POMODORO REALM</a>
        <a href="https://the-chosen-one-o5.github.io/Daily-Schedule/" target="_blank" rel="noreferrer">DAILY QUEST PLANNER</a>
      </div>
      <div class="sidebar-section">
        <h3>Account</h3>
        <button id="streakShieldBtn">STREAK SHIELD</button>
        <button id="doublePointsBtn">DOUBLE POINTS POWER-UP</button>
        <button id="logoutBtn">LOGOUT</button>
      </div>
    </div>
    <div id="landingPage">
      <div class="title">QUEST FOR <span>FOCUS</span></div>
      <div class="subtitle">Begin your learning adventure!</div>
      <button data-action="start-game">START GAME</button>
      <button class="github-btn" data-action="github">GITHUB REPO</button>
      <div id="features">
        <div class="feature">
          <i class="fas fa-ad"></i>
          <p>Ad Free<br>No distractions on your quest</p>
        </div>
        <div class="feature">
          <i class="fas fa-moon"></i>
          <p>Dark Mode<br>Save your vision for the final boss</p>
        </div>
      </div>
    </div>

    <div id="signinForm" style="display: none;">
      <div class="title">CREATE YOUR <span>ACCOUNT</span></div>
      <div class="subtitle">Sign in to track your progress</div>
      <input type="text" id="username" placeholder="Hero Name" required />
      <input type="password" id="password" placeholder="Secret Code" required />
      <button data-action="sign-in">ENTER REALM</button>
      <p>New adventurer? <button data-action="create-account">CREATE ACCOUNT</button></p>
    </div>

    <div id="inputForm" style="display: none;">
      <div id="achievementLevel"></div>
      <div id="streakDisplay"></div>
      <button id="todoBtn">TO-DO</button>
      <button id="statsBtn">HERO STATS</button>
      <button id="pyqBtn">TRAINING GROUNDS</button>

      <div id="todoList">
        <h3>TO-DO</h3>
        <div id="tasks">
          <div class="task-line">
            <input type="checkbox" class="task-check" />
            <input type="text" class="task-text" placeholder="Add a quest..." />
            <span class="set-deadline">‚è∞</span>
            <span class="remove-task">x</span>
            <div class="deadline-popup">
              <input type="datetime-local" class="deadline-input" />
              <input type="number" class="points-input" min="50" max="300" step="10" placeholder="Points (50-300)" />
              <button class="save-deadline">Save</button>
            </div>
          </div>
        </div>
        <button data-action="save-tasks">SAVE QUESTS</button>
      </div>

      <div id="analytics">
        <h3>HERO STATS</h3>
        <p>Focus Time: <span id="totalFocusTime">0</span> min</p>
        <p>Distractions Defeated: <span id="totalDistractions">0</span></p>
        <p>Videos Completed: <span id="totalVideosWatched">0</span></p>
      </div>

      <div class="title">ENTER YOUR <span>YOUTUBE URL</span></div>
      <div class="subtitle"></div>
      <select id="playlistSelect">
        <option value="">Select a Playlist</option>
      </select>
      <input type="text" id="playlistName" placeholder="Save Path As..." />
      <button data-action="save-playlist">SAVE PLAYLIST</button>
      <button data-action="remove-playlist">DELETE PLAYLIST</button>

      <div id="urlInputs">
        <div class="url-container">
          <input type="text" class="youtube-url" placeholder="YouTube URL (Videos or Live Streams)" required />
        </div>
      </div>

      <button data-action="add-url">ADD URL</button>
      <button data-action="start-playback">BEGIN FOCUS</button>
    </div>

    <div id="player" style="display: none;"></div>

    <div id="timerDisplay">
      <button id="minimizeBtn">-</button>
      <span id="timerText"></span>
      <div id="progressBar">
        <div id="progressFill"></div>
      </div>
    </div>

    <div id="pointsDisplay"><span style="color: #8e2de2;">‚≠ê</span> XP: 0</div>
    <div id="clockDisplay"></div>

    <div id="sitesBox">ALLIED REALMS üëá</div>
    <div id="sitesPopup">
      <button id="closeSitesPopup">X</button>
      <a href="https://forestquest.vercel.app/" target="_blank" rel="noreferrer">FOREST QUEST - TASK MANAGEMENT</a>
      <a href="https://focuswithpomodoro.netlify.app/" target="_blank" rel="noreferrer">POMODORO REALM</a>
      <a href="https://the-chosen-one-o5.github.io/Daily-Schedule/" target="_blank" rel="noreferrer">DAILY QUEST PLANNER</a>
    </div>

    <button id="restartBtn" style="display: none;">EXIT</button>

    <div id="videoSidebar"></div>

    <div id="lofiPlayer">
      <div style="text-align: center; margin-bottom: 5px;">LOFI MUSIC ‚ô¨</div>
      <button id="lofiPrev">‚óÑ</button>
      <button id="lofiPlay">‚ñ∂</button>
      <button id="lofiPause">‚ùö‚ùö</button>
      <button id="lofiNext">‚ñ∫</button>
    </div>

    <div id="achievementOverlay"></div>

    <div id="confirmationDialog" style="display: none;">
      <p>Are you sure you want to abandon your quest?</p>
      <button id="confirmBtn">YES</button>
      <button id="cancelBtn">NO</button>
    </div>

    <div id="streakShieldDialog" style="display: none;">
      <p>Are you sure you want to buy Streak Shield for 800 XP? (Protects streak for 1 week)</p>
      <button id="streakShieldConfirmBtn">YES</button>
      <button id="streakShieldCancelBtn">NO</button>
    </div>

    <div id="doublePointsDialog" style="display: none;">
      <p>Are you sure you want to buy Double Points Power-Up for 800 XP? (Doubles points for 24 hours)</p>
      <button id="doublePointsConfirmBtn">YES</button>
      <button id="doublePointsCancelBtn">NO</button>
    </div>

    <button id="pdfToggle">PDF UPLOAD</button>

    <div id="pdfViewer">
      <input type="file" id="pdfInput" accept=".pdf" />
      <iframe id="pdfFrame"></iframe>
      <button onclick="togglePDFViewer()" style="background: #ff4444; margin-top: 10px;">CLOSE</button>
    </div>

    <div id="fireBox">üßô</div>
    <div id="aiPopup">
      <iframe src="https://www.chatbase.co/chatbot-iframe/3dSdpryiYZlWipHUL8dNK" frameBorder="0"></iframe>
    </div>

    <div id="mysteryBoxPopup" style="display: none;">
      <h3>Focus Mystery Box</h3>
      <p id="mysteryRewardText">Click to reveal your reward!</p>
      <button id="openMysteryBox">OPEN</button>
    </div>

    <audio id="focusAudio" preload="none" src="https://the-chosen-one-o5.github.io/UltraFocusModeYT/focus.mp3"></audio>
    <audio id="lofiAudio" preload="none" loop></audio>
  </div>

  <script>
    ;(() => {
      let currentVideoIndex = 0
      let player
      let videoIds = []
      let isFocusModeActive = false
      let countdownInterval
      let distractionCount = 0
      let points = 0
      let isSignedIn = false
      let currentUser = null
      const focusDuration = 50 * 60 * 1000
      const firstBreakDuration = 15 * 60 * 1000
      const secondBreakDuration = 10 * 60 * 1000
      let timerMode = "Focus Time"
      let timerRemaining = focusDuration / 1000
      let completedVideos = new Set()
      let allVideosCompleted = false
      let totalFocusTime = 0
      let totalDistractions = 0
      let totalVideosWatched = 0
      let playlists = JSON.parse(localStorage.getItem("playlists") || "[]")
      let tasks = JSON.parse(localStorage.getItem("tasks") || "[]")
      let previousPoints = 0
      let streakDays = 0
      let lastFocusDate = null
      let isYouTubeAPILoaded = false
      let lofiAudio
      const lofiSongs = [
        "https://www.dropbox.com/scl/fi/7qrgbk6vpej7x0ih7vev2/1-6_XRwBX7NX-1.mp3?rlkey=m3gntnys7az2hoq0iokkajucj&st=bmrhzjy8&dl=1",
        "https://www.dropbox.com/scl/fi/ykeun00q1t03kzpeow819/music-to-make-your-brain-shut-up-a-dark-academia-playlist-4.mp3?rlkey=3hnw2vk2ck0yjnr9oekk2xqld&st=hh77z1k0&dl=1",
        "https://www.dropbox.com/scl/fi/pe09xx1c680gzymsa2gdf/NEOTIC-Calm-Your-Anxiety.mp3?rlkey=2hp7su9j541mpcdkw4ccavx58&st=yles17dd&dl=1",
        "https://www.dropbox.com/scl/fi/lb5f47widcz8mwhg79jiz/Kate-Grove-SKYRIM-THEME-skyrim-elderscrolls-ocarina.mp3?rlkey=f8kpm1ipyowc1wv998myu06us&st=bm9qmodf&dl=1",
        "https://www.dropbox.com/scl/fi/8wf64nv0rwubt7hbs5x20/Kurate-Music-Best-of-Gibran-Alcocer-Beautiful-Piano-Mix.mp3?rlkey=i776feuxag0ebullqe0kjo0gp&st=bb3uyo3h&dl=1",
        "https://www.dropbox.com/scl/fi/7xoemzmrgq0wzbxc9i9tp/Jumping-_brick-Sidewalks-and-skeletons-goth-slowed-reverb-best-part-loop.mp3?rlkey=d4dt6rv6sdzteextqek29geug&st=4umnyp0c&dl=1",
        "https://www.dropbox.com/scl/fi/macw47c2kvur0yfi4r9up/St3phen-If-Youre-A-Gamer-This-Song-FOUND-You.mp3?rlkey=qudky54311tppavhvnpra89ff&st=7dgshk5k&dl=1",
        "https://www.dropbox.com/scl/fi/c1iy5yjmf3d57jrb1aokc/KestrelTapes-what-nostalgia-sounds-like...mp3?rlkey=qcdj1vpdnzwdb03fxp0vk0661&st=fyqrl6ge&dl=1",
        "https://www.dropbox.com/scl/fi/p303xk68pvu8sfrmtwzj2/rhawn-there-is-hopecore.mp3?rlkey=m6tva7g4dsva39ii1l0e8tnu0&st=6z218pii&dl=1",
        "https://www.dropbox.com/scl/fi/bw4n0ne8nli4dkp7p26po/Jaob-not-just-another-hopecore-playlist.mp3?rlkey=jy0umwkadkxj9cju1yf2wz7hw&st=yjxhzw0s&dl=1",
        "https://www.dropbox.com/scl/fi/evhrjdri6a9n9bk05qhcu/Kyle-Dixon-Michael-Stei-Kids.mp3?rlkey=lauo50rz3indg5n3to5gfks1y&st=gcqmonsf&dl=1",
      ]
      let currentLofiIndex = 0

      // Reminder feature variables
      let reminderInterval
      let timeOnInputForm = 0
      const reminderIntervalTime = 20 * 60 * 1000 // 20 minutes in milliseconds
      const reminderThreshold = 20 * 60 * 1000 // 20 minutes threshold

      // Mystery Box and Power-Up feature variables
      let mysteryBoxCount = 0
      let activePowerUps = {
        doublePoints: { active: false, expiry: null },
        streakShield: { active: false, used: false, expiry: null },
      }
      const STREAK_SHIELD_COST = 800
      const STREAK_SHIELD_DURATION = 7 * 24 * 60 * 60 * 1000 // 1 week in milliseconds
      const DOUBLE_POINTS_COST = 800
      const DOUBLE_POINTS_DURATION = 24 * 60 * 60 * 1000 // 24 hours in milliseconds
      const MYSTERY_BOX_STREAK_INTERVAL = 14
      const mysteryBoxRewards = [
        { type: "points", value: () => Math.floor(Math.random() * 451) + 50, message: (val) => `+${val} XP` },
        { type: "doublePoints", value: DOUBLE_POINTS_DURATION, message: () => "Double Points for 24 Hours" },
        { type: "streakShield", value: 1, message: () => "1-Day Streak Shield" },
      ]

      const achievementLevels = [
        { points: 0, level: "Mortal", color: "white" },
        { points: 1000, level: "Soldier", color: "#4169E1" },
        { points: 2000, level: "Knight", color: "white", glow: true },
        { points: 3000, level: "KING", color: "#FF8C00", glow: true },
        { points: 4000, level: "GIGACHAD", color: "#FF4500", glow: true },
        { points: 5000, level: "Demigod", color: "gold", glow: true },
        { points: 6000, level: "Titan", color: "gold", glow: true, box: true },
        { points: 7000, level: "Immortal", color: "gold", glow: true, box: true, boxGlow: true },
        { points: 8000, level: "Celestial", color: "gold", glow: true, box: true, boxGlow: true },
        { points: 9000, level: "Divine", color: "rainbow" },
        { points: 10000, level: "Omnipotent", color: "rainbow", glow: true },
      ]

      function initAudio() {
        lofiAudio = document.getElementById("lofiAudio")
        if (lofiAudio) lofiAudio.src = lofiSongs[currentLofiIndex]
      }

      function getAchievementLevel(points) {
        let currentLevel = achievementLevels[0]
        for (const level of achievementLevels) {
          if (points >= level.points) currentLevel = level
          else break
        }
        return currentLevel
      }

      function updateAchievementLevel() {
        const achievementDiv = document.getElementById("achievementLevel")
        if (!achievementDiv) return

        const level = getAchievementLevel(points)
        let style = `color: ${level.color}; font-weight: bold;`
        if (level.glow) style += " text-shadow: 0 0 10px;"
        if (level.box) style += " border: 2px solid gold; padding: 5px;"
        if (level.boxGlow) style += " box-shadow: 0 0 10px gold;"
        if (level.color === "rainbow") achievementDiv.classList.add("rainbow")
        else achievementDiv.classList.remove("rainbow")
        achievementDiv.innerHTML = level.level
        achievementDiv.style = style
        updateSidebarDashboard()
      }

      function showAchievementOverlay(level) {
        const overlay = document.getElementById("achievementOverlay")
        if (!overlay) return

        overlay.textContent = `LEVEL UP! ${level.toUpperCase()} UNLOCKED!`
        overlay.style.display = "flex"
        setTimeout(() => overlay.style.display = "none", 5000)
      }

      function updateClock() {
        const clockDisplay = document.getElementById("clockDisplay")
        if (!clockDisplay) return

        const now = new Date()
        let hours = now.getHours()
        const minutes = now.getMinutes().toString().padStart(2, "0")
        const seconds = now.getSeconds().toString().padStart(2, "0")
        const period = hours >= 12 ? "PM" : "AM"
        hours = hours % 12 || 12
        hours = hours.toString().padStart(2, "0")
        clockDisplay.innerHTML = `<span class="time">${hours}:${minutes}:${seconds}</span> <span class="period">${period}</span>`
      }

      function playLofi() {
        if (!lofiAudio) return
        lofiAudio.play().catch((err) => console.error("Lofi play error:", err))
      }

      function pauseLofi() {
        if (!lofiAudio) return
        lofiAudio.pause()
      }

      function prevLofi() {
        if (!lofiAudio) return
        currentLofiIndex = (currentLofiIndex - 1 + lofiSongs.length) % lofiSongs.length
        lofiAudio.src = lofiSongs[currentLofiIndex]
        playLofi()
      }

      function nextLofi() {
        if (!lofiAudio) return
        currentLofiIndex = (currentLofiIndex + 1) % lofiSongs.length
        lofiAudio.src = lofiSongs[currentLofiIndex]
        playLofi()
      }

      function toggleSitesPopup() {
        const popup = document.getElementById("sitesPopup")
        if (!popup) return
        popup.style.display = popup.style.display === "block" ? "none" : "block"
      }

      function closeSitesPopup() {
        const popup = document.getElementById("sitesPopup")
        if (!popup) return
        popup.style.display = "none"
      }

      function updateStreak() {
        const streakDisplay = document.getElementById("streakDisplay")
        if (!streakDisplay) return

        const today = new Date().toDateString()
        const lastDate = localStorage.getItem("lastFocusDate")

        if (lastDate) {
          const last = new Date(lastDate)
          const diffTime = new Date(today) - last
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24))

          if (diffDays === 1) {
            streakDays++
            checkMysteryBoxMilestone()
          } else if (diffDays > 1) {
            if (activePowerUps.streakShield.active && Date.now() < activePowerUps.streakShield.expiry) {
              streakDays++
              alert("Streak Shield protected your streak!")
            } else {
              streakDays = 0 // Reset streak if no focus session and no active shield
            }
          }
        } else {
          streakDays = 1 // First focus session
        }

        localStorage.setItem("lastFocusDate", today)
        streakDisplay.innerHTML = `<span style="color: #8e2de2;">üî•</span> ${streakDays} day${streakDays === 1 ? "" : "s"} of focus`

        if (isSignedIn && currentUser) {
          const users = JSON.parse(localStorage.getItem("users") || "{}")
          users[currentUser].streakDays = streakDays
          users[currentUser].mysteryBoxCount = mysteryBoxCount
          users[currentUser].activePowerUps = activePowerUps
          localStorage.setItem("users", JSON.stringify(users))
        }

        const sidebarStreak = document.getElementById("sidebarStreak")
        if (sidebarStreak) sidebarStreak.textContent = `${streakDays} day${streakDays === 1 ? "" : "s"}`
      }

      function checkMysteryBoxMilestone() {
        if (streakDays > 0 && streakDays % MYSTERY_BOX_STREAK_INTERVAL === 0) {
          mysteryBoxCount++
          showMysteryBoxPopup()
          saveState()
        }
      }

      function showMysteryBoxPopup() {
        const popup = document.getElementById("mysteryBoxPopup")
        const rewardText = document.getElementById("mysteryRewardText")
        if (!popup || !rewardText) return

        rewardText.textContent = `You earned a Focus Mystery Box! (${mysteryBoxCount} available)`
        popup.style.display = "block"
      }

      function openMysteryBox() {
        if (mysteryBoxCount <= 0) return

        const popup = document.getElementById("mysteryBoxPopup")
        const rewardText = document.getElementById("mysteryRewardText")
        if (!popup || !rewardText) return

        const reward = mysteryBoxRewards[Math.floor(Math.random() * mysteryBoxRewards.length)]
        let rewardValue = reward.value instanceof Function ? reward.value() : reward.value

        switch (reward.type) {
          case "points":
            points += rewardValue
            break
          case "doublePoints":
            activePowerUps.doublePoints.active = true
            activePowerUps.doublePoints.expiry = Date.now() + rewardValue
            setTimeout(() => {
              activePowerUps.doublePoints.active = false
              saveState()
              alert("Double Points power-up has expired!")
            }, rewardValue)
            break
          case "streakShield":
            activePowerUps.streakShield.active = true
            activePowerUps.streakShield.used = false
            activePowerUps.streakShield.expiry = Date.now() + STREAK_SHIELD_DURATION
            setTimeout(() => {
              activePowerUps.streakShield.active = false
              saveState()
              alert("Streak Shield has expired!")
            }, STREAK_SHIELD_DURATION)
            break
        }

        rewardText.textContent = `Reward: ${reward.message(rewardValue)}`
        mysteryBoxCount--
        document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
        saveState()

        setTimeout(() => {
          if (mysteryBoxCount > 0) showMysteryBoxPopup()
          else popup.style.display = "none"
        }, 2000)
      }

      function applyPowerUps(pointsEarned) {
        if (activePowerUps.doublePoints.active && Date.now() < activePowerUps.doublePoints.expiry) {
          return pointsEarned * 2
        }
        return pointsEarned
      }

      function showStreakShieldDialog() {
        const dialog = document.getElementById("streakShieldDialog")
        if (!dialog) return
        if (points < STREAK_SHIELD_COST) {
          alert("Not enough XP! You need 800 XP to buy a Streak Shield.")
          return
        }
        dialog.style.display = "block"
      }

      function handleStreakShieldConfirmation(choice) {
        const dialog = document.getElementById("streakShieldDialog")
        if (!dialog) return

        dialog.style.display = "none"
        if (choice === "yes") {
          points -= STREAK_SHIELD_COST
          activePowerUps.streakShield.active = true
          activePowerUps.streakShield.used = false
          activePowerUps.streakShield.expiry = Date.now() + STREAK_SHIELD_DURATION
          document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
          alert("Streak Shield activated for 1 week!")
          saveState()
          setTimeout(() => {
            activePowerUps.streakShield.active = false
            saveState()
            alert("Your Streak Shield has expired!")
          }, STREAK_SHIELD_DURATION)
        }
      }

      function showDoublePointsDialog() {
        const dialog = document.getElementById("doublePointsDialog")
        if (!dialog) return
        if (points < DOUBLE_POINTS_COST) {
          alert("Not enough XP! You need 800 XP to buy Double Points Power-Up.")
          return
        }
        dialog.style.display = "block"
      }

      function handleDoublePointsConfirmation(choice) {
        const dialog = document.getElementById("doublePointsDialog")
        if (!dialog) return

        dialog.style.display = "none"
        if (choice === "yes") {
          points -= DOUBLE_POINTS_COST
          activePowerUps.doublePoints.active = true
          activePowerUps.doublePoints.expiry = Date.now() + DOUBLE_POINTS_DURATION
          document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
          alert("Double Points Power-Up activated for 24 hours!")
          saveState()
          setTimeout(() => {
            activePowerUps.doublePoints.active = false
            saveState()
            alert("Your Double Points Power-Up has expired!")
          }, DOUBLE_POINTS_DURATION)
        }
      }

      // Reminder feature functions
      function startReminderTimer() {
        const inputForm = document.getElementById("inputForm")
        if (inputForm.style.display !== "block") {
          stopReminderTimer()
          timeOnInputForm = 0
          return
        }

        reminderInterval = setInterval(() => {
          timeOnInputForm += reminderIntervalTime
          if (timeOnInputForm >= reminderThreshold) {
            if ("Notification" in window && Notification.permission === "granted") {
              new Notification("Check Your To-Do List!", {
                body: "Hey hero, don't forget to review your quests!",
                icon: "https://img.icons8.com/ios-filled/50/ffffff/checklist.png",
              })
            } else if ("Notification" in window && Notification.permission !== "denied") {
              Notification.requestPermission().then((permission) => {
                if (permission === "granted") {
                  new Notification("Check Your To-Do List!", {
                    body: "Hey hero, don't forget to review your quests!",
                    icon: "https://img.icons8.com/ios-filled/50/ffffff/checklist.png",
                  })
                } else {
                  alert("Reminder: Check your to-do list!")
                }
              })
            } else {
              alert("Reminder: Check your to-do list!")
            }
          }
        }, reminderIntervalTime)
      }

      function stopReminderTimer() {
        if (reminderInterval) {
          clearInterval(reminderInterval)
          reminderInterval = null
        }
      }

      function loadSavedState() {
        try {
          const savedState = localStorage.getItem("focusModeState")
          if (savedState) {
            const progressBar = document.getElementById("progressBar")
            if (progressBar) progressBar.style.display = "none"

            const state = JSON.parse(savedState)
            videoIds = state.videoIds || []
            currentVideoIndex = state.currentVideoIndex || 0
            distractionCount = state.distractionCount || 0
            points = state.points || 0
            timerMode = state.timerMode || "Focus Time"
            timerRemaining = state.timerRemaining || focusDuration / 1000
            isFocusModeActive = state.isFocusModeActive || false
            isSignedIn = state.isSignedIn || false
            currentUser = state.currentUser || null
            completedVideos = new Set(state.completedVideos || [])
            allVideosCompleted = state.allVideosCompleted || false
            totalFocusTime = state.totalFocusTime || 0
            totalDistractions = state.totalDistractions || 0
            totalVideosWatched = state.totalVideosWatched || 0
            streakDays = state.streakDays || 0
            lastFocusDate = state.lastFocusDate || null
            mysteryBoxCount = state.mysteryBoxCount || 0
            activePowerUps = state.activePowerUps || {
              doublePoints: { active: false, expiry: null },
              streakShield: { active: false, used: false, expiry: null },
            }

            updateAnalytics()
            updateAchievementLevel()
            updateStreak()
            if (isSignedIn && currentUser) {
              document.getElementById("landingPage").style.display = "none"
              document.getElementById("signinForm").style.display = "none"
              document.getElementById("inputForm").style.display = "block"
              document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
              document.getElementById("clockDisplay").style.display = "block"
              document.getElementById("sitesBox").style.display = "block"
              document.getElementById("lofiPlayer").style.display = "block"
              restoreUrlInputs()
              populatePlaylistSelect()
              restoreTasks()
              startReminderTimer()
              if (mysteryBoxCount > 0) showMysteryBoxPopup()
            }
            if (videoIds.length > 0) {
              document.getElementById("inputForm").style.display = "none"
              document.getElementById("player").style.display = "block"
              document.getElementById("restartBtn").style.display = "block"
              document.getElementById("pdfToggle").style.display = "block"
              document.getElementById("clockDisplay").style.display = "none"
              document.getElementById("sitesBox").style.display = "none"
              document.getElementById("lofiPlayer").style.display = "none"
              stopReminderTimer()
              loadYouTubeAPI()
                .then(() => {
                  setupYouTubePlayer()
                  if (isFocusModeActive) startTimer(timerRemaining * 1000, timerMode)
                })
                .catch((err) => console.error("YouTube API load failed:", err))
            }
          } else {
            document.getElementById("landingPage").style.display = "block"
            document.getElementById("signinForm").style.display = "none"
            document.getElementById("inputForm").style.display = "none"
            document.getElementById("clockDisplay").style.display = "none"
            document.getElementById("sitesBox").style.display = "none"
            document.getElementById("lofiPlayer").style.display = "none"
            stopReminderTimer()
            updateAnalytics()
            updateAchievementLevel()
            updateStreak()
            restoreTasks()
          }
        } catch (err) {
          console.error("Load saved state error:", err)
        }
      }

      function redirectToPYQs() {
        window.open("https://room.examgoal.com/", "_blank")
      }

      function showSignIn() {
        document.getElementById("landingPage").style.display = "none"
        document.getElementById("signinForm").style.display = "block"
        document.getElementById("inputForm").style.display = "none"
        document.getElementById("clockDisplay").style.display = "none"
        document.getElementById("sitesBox").style.display = "none"
        document.getElementById("lofiPlayer").style.display = "none"
        stopReminderTimer()
      }

      function signIn() {
        try {
          const username = document.getElementById("username").value
          const password = document.getElementById("password").value
          const users = JSON.parse(localStorage.getItem("users") || "{}")
          if (users[username] && users[username].password === password) {
            isSignedIn = true
            currentUser = username
            points = users[username].points || 0
            totalFocusTime = users[username].totalFocusTime || 0
            totalDistractions = users[username].totalDistractions || 0
            totalVideosWatched = users[username].totalVideosWatched || 0
            tasks = users[username].tasks || []
            streakDays = users[username].streakDays || 0
            mysteryBoxCount = users[username].mysteryBoxCount || 0
            activePowerUps = users[username].activePowerUps || {
              doublePoints: { active: false, expiry: null },
              streakShield: { active: false, used: false, expiry: null },
            }
            document.getElementById("landingPage").style.display = "none"
            document.getElementById("signinForm").style.display = "none"
            document.getElementById("inputForm").style.display = "block"
            document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
            document.getElementById("clockDisplay").style.display = "block"
            document.getElementById("sitesBox").style.display = "block"
            document.getElementById("lofiPlayer").style.display = "block"
            updateAnalytics()
            updateAchievementLevel()
            updateStreak()
            saveState()
            populatePlaylistSelect()
            restoreTasks()
            startReminderTimer()
            if (mysteryBoxCount > 0) showMysteryBoxPopup()
            updateSidebarDashboard()
          } else alert("Invalid username or password")
        } catch (err) {
          console.error("Sign-in error:", err)
          alert("Error during sign-in. Please try again.")
        }
      }

      function createAccount() {
        try {
          const username = document.getElementById("username").value
          const password = document.getElementById("password").value
          const users = JSON.parse(localStorage.getItem("users") || "{}")
          if (users[username]) alert("Username already exists")
          else if (username && password) {
            users[username] = {
              password,
              points: 0,
              totalFocusTime: 0,
              totalDistractions: 0,
              totalVideosWatched: 0,
              tasks: [],
              streakDays: 0,
              mysteryBoxCount: 0,
              activePowerUps: {
                doublePoints: { active: false, expiry: null },
                streakShield: { active: false, used: false, expiry: null },
              },
            }
            localStorage.setItem("users", JSON.stringify(users))
            isSignedIn = true
            currentUser = username
            points = 0
            totalFocusTime = 0
            totalDistractions = 0
            totalVideosWatched = 0
            tasks = []
            streakDays = 0
            mysteryBoxCount = 0
            activePowerUps = {
              doublePoints: { active: false, expiry: null },
              streakShield: { active: false, used: false, expiry: null },
            }
            document.getElementById("landingPage").style.display = "none"
            document.getElementById("signinForm").style.display = "none"
            document.getElementById("inputForm").style.display = "block"
            document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
            document.getElementById("clockDisplay").style.display = "block"
            document.getElementById("sitesBox").style.display = "block"
            document.getElementById("lofiPlayer").style.display = "block"
            updateAnalytics()
            updateAchievementLevel()
            updateStreak()
            saveState()
            populatePlaylistSelect()
            restoreTasks()
            startReminderTimer()
            updateSidebarDashboard()
          } else alert("Please enter a username and password")
        } catch (err) {
          console.error("Account creation error:", err)
          alert("Error creating account. Please try again.")
        }
      }

      function addUrlInput() {
        const urlInputs = document.getElementById("urlInputs")
        if (!urlInputs) return

        const container = document.createElement("div")
        container.className = "url-container"
        const newInput = document.createElement("input")
        newInput.type = "text"
        newInput.className = "youtube-url"
        newInput.placeholder = "YouTube URL (Videos or Live Streams)"
        const removeBtn = document.createElement("button")
        removeBtn.textContent = "X"
        removeBtn.onclick = () => {
          if (urlInputs.children.length > 1) urlInputs.removeChild(container)
        }
        container.appendChild(newInput)
        container.appendChild(removeBtn)
        urlInputs.appendChild(container)
      }

      function restoreUrlInputs() {
        const urlInputs = document.getElementById("urlInputs")
        if (!urlInputs) return

        urlInputs.innerHTML = ""
        videoIds.forEach((id, index) => {
          const container = document.createElement("div")
          container.className = "url-container"
          const input = document.createElement("input")
          input.type = "text"
          input.className = "youtube-url"
          input.placeholder = "YouTube URL (Videos or Live Streams)"
          input.value = `https://www.youtube.com/watch?v=${id}`
          container.appendChild(input)
          if (index > 0) {
            const removeBtn = document.createElement("button")
            removeBtn.textContent = "X"
            removeBtn.onclick = () => {
              if (urlInputs.children.length > 1) urlInputs.removeChild(container)
            }
            container.appendChild(removeBtn)
          }
          urlInputs.appendChild(container)
        })
        if (videoIds.length === 0) {
          const container = document.createElement("div")
          container.className = "url-container"
          const input = document.createElement("input")
          input.type = "text"
          input.className = "youtube-url"
          input.placeholder = "YouTube URL (Videos or Live Streams)"
          input.required = true
          container.appendChild(input)
          urlInputs.appendChild(container)
        }
      }

      function addTaskLine() {
        const tasksDiv = document.getElementById("tasks")
        if (!tasksDiv) return null

        const container = document.createElement("div")
        container.className = "task-line"
        const checkbox = document.createElement("input")
        checkbox.type = "checkbox"
        checkbox.className = "task-check"
        checkbox.onchange = () => handleTaskCompletion(checkbox)
        const input = document.createElement("input")
        input.type = "text"
        input.className = "task-text"
        input.placeholder = "Add a quest..."
        input.onkeydown = (e) => {
          if (e.key === "Enter") {
            e.preventDefault()
            const newInput = addTaskLine()
            if (newInput) newInput.focus()
          }
        }
        input.onchange = () => saveTasks()
        const deadlineBtn = document.createElement("span")
        deadlineBtn.className = "set-deadline"
        deadlineBtn.textContent = "‚è∞"
        deadlineBtn.onclick = () => toggleDeadlinePopup(deadlineBtn)
        const removeBtn = document.createElement("span")
        removeBtn.className = "remove-task"
        removeBtn.textContent = "x"
        removeBtn.onclick = () => removeTask(removeBtn)
        const popup = document.createElement("div")
        popup.className = "deadline-popup"
        const deadlineInput = document.createElement("input")
        deadlineInput.type = "datetime-local"
        deadlineInput.className = "deadline-input"
        const pointsInput = document.createElement("input")
        pointsInput.type = "number"
        pointsInput.className = "points-input"
        pointsInput.min = "50"
        pointsInput.max = "300"
        pointsInput.step = "10"
        pointsInput.placeholder = "Points (50-300)"
        const saveDeadlineBtn = document.createElement("button")
        saveDeadlineBtn.className = "save-deadline"
        saveDeadlineBtn.textContent = "Save"
        saveDeadlineBtn.onclick = () => saveDeadline(container)
        popup.appendChild(deadlineInput)
popup.appendChild(pointsInput)
popup.appendChild(saveDeadlineBtn)
container.appendChild(checkbox)
container.appendChild(input)
container.appendChild(deadlineBtn)
container.appendChild(removeBtn)
container.appendChild(popup)
tasksDiv.appendChild(container)
return input
}

function toggleDeadlinePopup(deadlineBtn) {
const popup = deadlineBtn.nextElementSibling.nextElementSibling // Navigate to the popup div
if (!popup) return
popup.style.display = popup.style.display === "block" ? "none" : "block"
}

function saveDeadline(taskLine) {
const deadlineInput = taskLine.querySelector(".deadline-input")
const pointsInput = taskLine.querySelector(".points-input")
const taskText = taskLine.querySelector(".task-text")
if (!deadlineInput || !pointsInput || !taskText) return

const deadline = deadlineInput.value ? new Date(deadlineInput.value).getTime() : null
let pointsValue = parseInt(pointsInput.value) || 0
pointsValue = Math.max(50, Math.min(300, pointsValue)) // Clamp points between 50 and 300

const taskData = {
text: taskText.value,
completed: taskLine.querySelector(".task-check").checked,
deadline: deadline,
points: pointsValue,
}

updateTaskInList(taskLine, taskData)
taskLine.querySelector(".deadline-popup").style.display = "none"
saveTasks()
checkDeadlines()
}

function updateTaskInList(taskLine, taskData) {
const index = Array.from(taskLine.parentElement.children).indexOf(taskLine)
if (index >= 0 && index < tasks.length) {
tasks[index] = taskData
} else {
tasks.push(taskData)
}
}

function removeTask(removeBtn) {
const taskLine = removeBtn.parentElement
const index = Array.from(taskLine.parentElement.children).indexOf(taskLine)
if (index >= 0 && index < tasks.length) {
tasks.splice(index, 1)
}
taskLine.remove()
saveTasks()
}

function handleTaskCompletion(checkbox) {
const taskLine = checkbox.parentElement
const index = Array.from(taskLine.parentElement.children).indexOf(taskLine)
if (index < 0 || index >= tasks.length) return

const task = tasks[index]
task.completed = checkbox.checked

if (task.completed && task.deadline && Date.now() <= task.deadline) {
let earnedPoints = task.points
earnedPoints = applyPowerUps(earnedPoints)
points += earnedPoints
document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
updateAchievementLevel()
}

saveTasks()
checkLevelUp()
}

function restoreTasks() {
const tasksDiv = document.getElementById("tasks")
if (!tasksDiv) return

tasksDiv.innerHTML = ""
tasks.forEach((task) => {
const taskLine = addTaskLine()
if (!taskLine) return
taskLine.value = task.text
taskLine.previousElementSibling.checked = task.completed
if (task.deadline) {
const deadlineInput = taskLine.parentElement.querySelector(".deadline-input")
deadlineInput.value = new Date(task.deadline).toISOString().slice(0, 16)
}
if (task.points) {
const pointsInput = taskLine.parentElement.querySelector(".points-input")
pointsInput.value = task.points
}
})
if (tasks.length === 0) addTaskLine()
checkDeadlines()
}

function saveTasks() {
const taskLines = document.querySelectorAll(".task-line")
tasks = Array.from(taskLines).map((line) => {
const deadlineInput = line.querySelector(".deadline-input")
const pointsInput = line.querySelector(".points-input")
return {
text: line.querySelector(".task-text").value,
completed: line.querySelector(".task-check").checked,
deadline: deadlineInput.value ? new Date(deadlineInput.value).getTime() : null,
points: parseInt(pointsInput.value) || 0,
}
})
localStorage.setItem("tasks", JSON.stringify(tasks))
if (isSignedIn && currentUser) {
const users = JSON.parse(localStorage.getItem("users") || "{}")
users[currentUser].tasks = tasks
localStorage.setItem("users", JSON.stringify(users))
}
}

function checkDeadlines() {
const now = Date.now()
tasks.forEach((task, index) => {
if (task.deadline && !task.completed && now > task.deadline) {
const penalty = Math.floor(task.points / 2)
points -= penalty
points = Math.max(0, points)
document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
alert(`Deadline missed for "${task.text}"! -${penalty} XP`)
task.completed = true // Mark as completed to prevent repeated penalties
const taskLine = document.querySelectorAll(".task-line")[index]
if (taskLine) taskLine.querySelector(".task-check").checked = true
}
})
saveTasks()
updateAchievementLevel()
}

function checkLevelUp() {
const currentLevel = getAchievementLevel(previousPoints)
const newLevel = getAchievementLevel(points)
if (newLevel.points > currentLevel.points) {
showAchievementOverlay(newLevel.level)
}
previousPoints = points
}

function populatePlaylistSelect() {
const select = document.getElementById("playlistSelect")
if (!select) return

select.innerHTML = '<option value="">Select a Playlist</option>'
playlists.forEach((playlist) => {
const option = document.createElement("option")
option.value = playlist.name
option.textContent = playlist.name
select.appendChild(option)
})
select.onchange = () => {
const selected = playlists.find((p) => p.name === select.value)
if (selected) {
videoIds = selected.videoIds
restoreUrlInputs()
}
}
}

function savePlaylist() {
const playlistName = document.getElementById("playlistName").value.trim()
if (!playlistName) {
alert("Please enter a playlist name")
return
}
const urls = Array.from(document.querySelectorAll(".youtube-url")).map((input) => input.value.trim())
const newVideoIds = urls.map((url) => extractVideoId(url)).filter((id) => id)
if (newVideoIds.length === 0) {
alert("No valid YouTube URLs provided")
return
}
const existingIndex = playlists.findIndex((p) => p.name === playlistName)
if (existingIndex >= 0) {
playlists[existingIndex].videoIds = newVideoIds
} else {
playlists.push({ name: playlistName, videoIds: newVideoIds })
}
localStorage.setItem("playlists", JSON.stringify(playlists))
populatePlaylistSelect()
document.getElementById("playlistName").value = ""
alert("Playlist saved!")
}

function removePlaylist() {
const select = document.getElementById("playlistSelect")
const playlistName = select.value
if (!playlistName) {
alert("Please select a playlist to delete")
return
}
playlists = playlists.filter((p) => p.name !== playlistName)
localStorage.setItem("playlists", JSON.stringify(playlists))
populatePlaylistSelect()
document.getElementById("urlInputs").innerHTML = ""
addUrlInput()
select.value = ""
alert("Playlist deleted!")
}

function extractVideoId(url) {
const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i
const match = url.match(regex)
return match ? match[1] : null
}

function startPlayback() {
const urls = Array.from(document.querySelectorAll(".youtube-url")).map((input) => input.value.trim())
videoIds = urls.map((url) => extractVideoId(url)).filter((id) => id)
if (videoIds.length === 0) {
alert("Please enter at least one valid YouTube URL")
return
}
document.getElementById("inputForm").style.display = "none"
document.getElementById("player").style.display = "block"
document.getElementById("restartBtn").style.display = "block"
document.getElementById("pdfToggle").style.display = "block"
document.getElementById("clockDisplay").style.display = "none"
document.getElementById("sitesBox").style.display = "none"
document.getElementById("lofiPlayer").style.display = "none"
stopReminderTimer()
loadYouTubeAPI()
.then(() => {
setupYouTubePlayer()
startTimer(focusDuration, "Focus Time")
})
.catch((err) => console.error("YouTube API load failed:", err))
}

function loadYouTubeAPI() {
if (isYouTubeAPILoaded) return Promise.resolve()
return new Promise((resolve) => {
const tag = document.createElement("script")
tag.src = "https://www.youtube.com/iframe_api"
const firstScriptTag = document.getElementsByTagName("script")[0]
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag)
window.onYouTubeIframeAPIReady = () => {
isYouTubeAPILoaded = true
resolve()
}
})
}

function setupYouTubePlayer() {
if (!isYouTubeAPILoaded) return
const playerDiv = document.getElementById("player")
if (!playerDiv) return

player = new YT.Player("player", {
height: "100%",
width: "100%",
videoId: videoIds[currentVideoIndex],
playerVars: {
autoplay: 1,
controls: 1,
rel: 0,
fs: 1,
modestbranding: 1,
},
events: {
onReady: onPlayerReady,
onStateChange: onPlayerStateChange,
onError: onPlayerError,
},
})
populateVideoSidebar()
}

function onPlayerReady(event) {
event.target.playVideo()
}

function onPlayerStateChange(event) {
if (event.data === YT.PlayerState.ENDED) {
completedVideos.add(videoIds[currentVideoIndex])
totalVideosWatched++
updateAnalytics()
currentVideoIndex++
if (currentVideoIndex < videoIds.length) {
player.loadVideoById(videoIds[currentVideoIndex])
} else {
allVideosCompleted = true
alert("All videos completed! Great job, hero!")
endFocusMode()
}
}
}

function onPlayerError(event) {
console.error("YouTube Player Error:", event.data)
currentVideoIndex++
if (currentVideoIndex < videoIds.length) {
player.loadVideoById(videoIds[currentVideoIndex])
} else {
allVideosCompleted = true
alert("All videos completed or an error occurred!")
endFocusMode()
}
}

function populateVideoSidebar() {
const sidebar = document.getElementById("videoSidebar")
if (!sidebar) return

sidebar.innerHTML = '<button id="minimizeBtn">-</button>'
videoIds.forEach((id, index) => {
const img = document.createElement("img")
img.src = `https://img.youtube.com/vi/${id}/mqdefault.jpg`
img.className = "thumbnail"
img.alt = `Video ${index + 1}`
img.onclick = () => {
currentVideoIndex = index
player.loadVideoById(videoIds[currentVideoIndex])
sidebar.style.right = "-320px"
}
sidebar.appendChild(img)
})
sidebar.style.right = "0px"
document.getElementById("minimizeBtn").onclick = () => {
sidebar.style.right = sidebar.style.right === "0px" ? "-320px" : "0px"
}
}

function startTimer(duration, mode) {
const timerDisplay = document.getElementById("timerDisplay")
const progressFill = document.getElementById("progressFill")
const progressBar = document.getElementById("progressBar")
if (!timerDisplay || !progressFill || !progressBar) return

isFocusModeActive = true
timerMode = mode
let timeLeft = duration / 1000
timerRemaining = timeLeft
progressBar.style.display = "block"

const totalTime = duration / 1000
clearInterval(countdownInterval)
countdownInterval = setInterval(() => {
timeLeft--
timerRemaining = timeLeft
const minutes = Math.floor(timeLeft / 60)
const seconds = (timeLeft % 60).toString().padStart(2, "0")
timerDisplay.querySelector("#timerText").textContent = `${timerMode}: ${minutes}:${seconds}`

const progress = ((totalTime - timeLeft) / totalTime) * 100
progressFill.style.width = `${progress}%`

if (timerMode === "Focus Time") totalFocusTime += 1

if (timeLeft <= 0) {
clearInterval(countdownInterval)
progressBar.style.display = "none"
if (timerMode === "Focus Time") {
let pointsEarned = 50
pointsEarned = applyPowerUps(pointsEarned)
points += pointsEarned
document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: ${points}`
startTimer(firstBreakDuration, "Short Break")
updateStreak()
playFocusAudio()
} else if (timerMode === "Short Break") {
startTimer(focusDuration, "Focus Time")
} else if (timerMode === "Long Break") {
startTimer(focusDuration, "Focus Time")
}
updateAchievementLevel()
checkLevelUp()
saveState()
}
saveState()
updateAnalytics()
}, 1000)

makeElementDraggable(timerDisplay)
}

function playFocusAudio() {
const focusAudio = document.getElementById("focusAudio")
if (focusAudio) focusAudio.play().catch((err) => console.error("Focus audio error:", err))
}

function endFocusMode() {
clearInterval(countdownInterval)
isFocusModeActive = false
document.getElementById("player").style.display = "none"
document.getElementById("restartBtn").style.display = "none"
document.getElementById("pdfToggle").style.display = "none"
document.getElementById("timerDisplay").querySelector("#timerText").textContent = ""
document.getElementById("progressBar").style.display = "none"
document.getElementById("inputForm").style.display = "block"
document.getElementById("clockDisplay").style.display = "block"
document.getElementById("sitesBox").style.display = "block"
document.getElementById("lofiPlayer").style.display = "block"
startReminderTimer()
if (player) player.destroy()
restoreUrlInputs()
saveState()
checkDeadlines()
}

function makeElementDraggable(element) {
let pos1 = 0,
pos2 = 0,
pos3 = 0,
pos4 = 0
element.onmousedown = dragMouseDown

function dragMouseDown(e) {
e.preventDefault()
pos3 = e.clientX
pos4 = e.clientY
document.onmouseup = closeDragElement
document.onmousemove = elementDrag
}

function elementDrag(e) {
e.preventDefault()
pos1 = pos3 - e.clientX
pos2 = pos4 - e.clientY
pos3 = e.clientX
pos4 = e.clientY
element.style.top = element.offsetTop - pos2 + "px"
element.style.left = element.offsetLeft - pos1 + "px"
}

function closeDragElement() {
document.onmouseup = null
document.onmousemove = null
}
}

function toggleAnalytics() {
const analytics = document.getElementById("analytics")
if (!analytics) return
analytics.style.display = analytics.style.display === "block" ? "none" : "block"
}

function toggleTodoList() {
const todoList = document.getElementById("todoList")
if (!todoList) return
todoList.style.display = todoList.style.display === "block" ? "none" : "block"
}

function updateAnalytics() {
document.getElementById("totalFocusTime").textContent = Math.floor(totalFocusTime / 60)
document.getElementById("totalDistractions").textContent = totalDistractions
document.getElementById("totalVideosWatched").textContent = totalVideosWatched
if (isSignedIn && currentUser) {
const users = JSON.parse(localStorage.getItem("users") || "{}")
users[currentUser].totalFocusTime = totalFocusTime
users[currentUser].totalDistractions = totalDistractions
users[currentUser].totalVideosWatched = totalVideosWatched
localStorage.setItem("users", JSON.stringify(users))
}
}

function saveState() {
const state = {
videoIds,
currentVideoIndex,
distractionCount,
points,
timerMode,
timerRemaining,
isFocusModeActive,
isSignedIn,
currentUser,
completedVideos: Array.from(completedVideos),
allVideosCompleted,
totalFocusTime,
totalDistractions,
totalVideosWatched,
streakDays,
lastFocusDate: localStorage.getItem("lastFocusDate"),
mysteryBoxCount,
activePowerUps,
}
localStorage.setItem("focusModeState", JSON.stringify(state))
}

function togglePDFViewer() {
const pdfViewer = document.getElementById("pdfViewer")
const pdfToggle = document.getElementById("pdfToggle")
if (!pdfViewer || !pdfToggle) return

if (pdfViewer.style.display === "block") {
pdfViewer.style.display = "none"
pdfToggle.style.display = "block"
} else {
pdfViewer.style.display = "block"
pdfToggle.style.display = "none"
}

const pdfInput = document.getElementById("pdfInput")
const pdfFrame = document.getElementById("pdfFrame")
if (pdfInput && pdfFrame) {
pdfInput.onchange = (e) => {
const file = e.target.files[0]
if (file && file.type === "application/pdf") {
const url = URL.createObjectURL(file)
pdfFrame.src = url
} else {
alert("Please upload a valid PDF file")
}
}
}
}

function toggleAIPopup() {
const aiPopup = document.getElementById("aiPopup")
const fireBox = document.getElementById("fireBox")
if (!aiPopup || !fireBox) return

aiPopup.style.display = aiPopup.style.display === "block" ? "none" : "block"
}

function updateSidebarDashboard() {
const sidebarUsername = document.getElementById("sidebarUsername")
const sidebarLevel = document.getElementById("sidebarLevel")
const sidebarXP = document.getElementById("sidebarXP")
const sidebarStreak = document.getElementById("sidebarStreak")
if (!sidebarUsername || !sidebarLevel || !sidebarXP || !sidebarStreak) return

sidebarUsername.textContent = currentUser || "Guest"
sidebarLevel.textContent = getAchievementLevel(points).level
sidebarXP.textContent = points
sidebarStreak.textContent = `${streakDays} day${streakDays === 1 ? "" : "s"}`
}

document.addEventListener("DOMContentLoaded", () => {
initAudio()
loadSavedState()
setInterval(updateClock, 1000)

document.querySelectorAll("button[data-action]").forEach((btn) => {
btn.addEventListener("click", () => {
const action = btn.getAttribute("data-action")
if (action === "start-game") showSignIn()
else if (action === "github") window.open("https://github.com/The-Chosen-One-o5/UltraFocusModeYT", "_blank")
else if (action === "sign-in") signIn()
else if (action === "create-account") createAccount()
else if (action === "add-url") addUrlInput()
else if (action === "start-playback") startPlayback()
else if (action === "save-playlist") savePlaylist()
else if (action === "remove-playlist") removePlaylist()
else if (action === "save-tasks") saveTasks()
})
})

document.getElementById("restartBtn")?.addEventListener("click", () => {
const dialog = document.getElementById("confirmationDialog")
if (dialog) {
dialog.style.display = "block"
document.getElementById("confirmBtn").onclick = () => {
dialog.style.display = "none"
endFocusMode()
}
document.getElementById("cancelBtn").onclick = () => (dialog.style.display = "none")
}
})

document.getElementById("sitesBox")?.addEventListener("click", toggleSitesPopup)
document.getElementById("closeSitesPopup")?.addEventListener("click", closeSitesPopup)
document.getElementById("lofiPlay")?.addEventListener("click", playLofi)
document.getElementById("lofiPause")?.addEventListener("click", pauseLofi)
document.getElementById("lofiPrev")?.addEventListener("click", prevLofi)
document.getElementById("lofiNext")?.addEventListener("click", nextLofi)
document.getElementById("statsBtn")?.addEventListener("click", toggleAnalytics)
document.getElementById("todoBtn")?.addEventListener("click", toggleTodoList)
document.getElementById("pyqBtn")?.addEventListener("click", redirectToPYQs)
document.getElementById("pdfToggle")?.addEventListener("click", togglePDFViewer)
document.getElementById("fireBox")?.addEventListener("click", toggleAIPopup)
document.getElementById("openMysteryBox")?.addEventListener("click", openMysteryBox)

document.getElementById("streakShieldBtn")?.addEventListener("click", showStreakShieldDialog)
document.getElementById("streakShieldConfirmBtn")?.addEventListener("click", () => handleStreakShieldConfirmation("yes"))
document.getElementById("streakShieldCancelBtn")?.addEventListener("click", () => handleStreakShieldConfirmation("no"))

document.getElementById("doublePointsBtn")?.addEventListener("click", showDoublePointsDialog)
document.getElementById("doublePointsConfirmBtn")?.addEventListener("click", () => handleDoublePointsConfirmation("yes"))
document.getElementById("doublePointsCancelBtn")?.addEventListener("click", () => handleDoublePointsConfirmation("no"))

document.getElementById("logoutBtn")?.addEventListener("click", () => {
isSignedIn = false
currentUser = null
points = 0
totalFocusTime = 0
totalDistractions = 0
totalVideosWatched = 0
tasks = []
streakDays = 0
mysteryBoxCount = 0
activePowerUps = {
doublePoints: { active: false, expiry: null },
streakShield: { active: false, used: false, expiry: null },
}
localStorage.removeItem("focusModeState")
document.getElementById("landingPage").style.display = "block"
document.getElementById("inputForm").style.display = "none"
document.getElementById("pointsDisplay").innerHTML = `<span style="color: #8e2de2;">‚≠ê</span> XP: 0`
document.getElementById("clockDisplay").style.display = "none"
document.getElementById("sitesBox").style.display = "none"
document.getElementById("lofiPlayer").style.display = "none"
document.getElementById("achievementLevel").innerHTML = ""
document.getElementById("streakDisplay").innerHTML = ""
stopReminderTimer()
updateSidebarDashboard()
})

setInterval(checkDeadlines, 60 * 1000) // Check deadlines every minute
})
})
})();
</script>
</body>
</html>
       
